(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{202:function(e,t,n){e.exports=n(359)},347:function(e,t,n){},359:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(48),i=n(144),s=n(59),c=n(5),l=n.n(c),u=(n(211),n(68)),m=n(69),p=n(71),d=n(70),f=n(73),h=n(24),g=n(25),b=n(360),v=n(40),O=n(365),E=n(362),y=n(361),j=n(27),C=n(110);C.initializeApp({apiKey:"AIzaSyB2tCxT6yP0CWtCbD9JDj3ZKaxxW8T25PI",authDomain:"slacker-c3b01.firebaseapp.com",databaseURL:"https://slacker-c3b01.firebaseio.com",projectId:"slacker-c3b01",storageBucket:"slacker-c3b01.appspot.com",messagingSenderId:"286218247810"});var S=C.firestore(),x=n(83),N=n.n(x),k=function(e,t){return new Date(e.createdAt)-new Date(t.createdAt)},R=function(e){var t=e.id,n=e.name,a=e.people,o=e.messages;return{type:"CREATE_ROOM",room:{id:t,name:n,people:a,messages:void 0===o?[]:o}}},A=function(e,t){return{type:"UPDATE_MESSAGES",messages:e,roomId:t}};function D(){var e=Object(h.a)(["\n\tflex-shrink: 0;\n"]);return D=function(){return e},e}function w(){var e=Object(h.a)(["\n\tpadding-left: 14px;\n\tborder: none;\n\tborder-radius: 4px;\n\tflex-grow: 1;\n"]);return w=function(){return e},e}function T(){var e=Object(h.a)(["\n\theight: 50px;\n\tbackground-color: #fff;\n\tborder-radius: 4px;\n\tdisplay: flex;\n\tflex-direction: row;\n\tflex-shrink: 0;\n\tmargin-top: 10px;\n"]);return T=function(){return e},e}function _(){var e=Object(h.a)(["\n\tdisplay: flex;\n\tmin-height: 40px;\n\tborder-bottom: 1px solid grey;\n"]);return _=function(){return e},e}function I(){var e=Object(h.a)(["\n\tflex-grow: 1;\n\toverflow: scroll;\n"]);return I=function(){return e},e}function L(){var e=Object(h.a)(["\n\theight: 100%;\n\tpadding: 24;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: '#fff';\n\tjustify-content: center;\n\talign-items: center;\n"]);return L=function(){return e},e}function M(){var e=Object(h.a)(["\n\theight: 100%;\n\tpadding: 24;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: '#fff';\n"]);return M=function(){return e},e}var B=b.a.Header,U=b.a.Content,V=E.a.Title,P=g.a.div(M()),G=g.a.div(L()),J=g.a.div(I()),z=g.a.div(_()),K=g.a.form(T()),W=g.a.input(w()),F=g.a.button(D()),X=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).state={messageValue:""},n.messagesEnd=null,n.handleTyping=function(e){n.setState({messageValue:e.target.value})},n.scrollToBottom=function(){n.messagesEnd&&n.messagesEnd.scrollIntoView({behavior:"auto"})},n.handleSend=function(e){e.preventDefault();var t=n.props.room;if(t.id){var a=n.state.messageValue;n.props.trySendMessage(a,t.id),n.setState({messageValue:""})}},n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"componentDidUpdate",value:function(e){if(0===e.messages.length&&this.props.messages.length>0)this.scrollToBottom();else if(e.messages.length!==this.props.messages.length&&e.messages.length>0&&this.props.messages.length>0){var t=e.messages.slice(-1)[0],n=this.props.messages.slice(-1)[0];t.id!==n.id&&n&&n.sender.uid===this.props.auth.uid&&this.scrollToBottom()}}},{key:"render",value:function(){var e=this,t=this.props,n=t.room,r=t.messages,i=t.isLoading,s=o.a.createElement(G,null,o.a.createElement(y.a,{size:"large"}));return i||(s=o.a.createElement(P,null,o.a.createElement(J,null,r.map(function(e){return o.a.createElement(z,{key:e.id},e.text)}),o.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}})),o.a.createElement(K,{onSubmit:this.handleSend},o.a.createElement(W,{value:this.state.messageValue,onChange:this.handleTyping}),o.a.createElement(F,{type:"submit"},"Send")))),o.a.createElement(a.Fragment,null,o.a.createElement(B,{style:{background:"#fff",padding:16,display:"flex",flexRirection:"row",alignItems:"center"}},o.a.createElement(V,{style:{margin:0},level:3},n.name)),o.a.createElement(U,{style:{margin:"24px 16px",overflow:"initial"}},s))}}]),t}(a.Component),H=Object(r.b)(function(e,t){var n=t.match.params.roomId,a=e.rooms.find(function(e){return e.id===n}),o=a?a.messages:[];return{auth:e.auth,room:a||{id:null,name:"",messages:[]},messages:o,isLoading:!a}},{trySendMessage:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(a,o){var r=o().auth;if(r){var i={sender:{uid:r.uid,displayName:r.displayName},text:e,createdAt:N()().format(),status:n};return S.collection("rooms/".concat(t,"/messages")).add(i)}}}})(X),Z=n(109),q=n(364),Q=n(363);function Y(){var e=Object(h.a)(["\n\tmargin-top: 5px;\n\tmargin-bottom: 5px;\n"]);return Y=function(){return e},e}var $=q.a.TextArea,ee=E.a.Text,te=g.a.div(Y()),ne=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).state={roomName:"",description:""},n.handleChange=function(e){console.log(e.target.name),n.setState(Object(Z.a)({},e.target.name,e.target.value))},n.handleSubmit=function(){var e=n.props.auth,t=e.uid,a=e.displayName;if(t){console.log("Create this room pls");var o=n.state.roomName;if(o&&o.length>0){var r={name:o,people:{id:t,name:a,unread:0,lastRead:0}};n.props.tryCreateRoom(r),n.props.handleClose()}}},n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return o.a.createElement(Q.a,{title:"Create Room",visible:this.props.isOpen,onOk:this.handleSubmit,onCancel:this.props.handleClose,okButtonProps:{disabled:!this.props.auth.uid},cancelButtonProps:{disabled:!this.props.auth.uid}},o.a.createElement(te,null,o.a.createElement(ee,null,"Name:")),o.a.createElement(q.a,{name:"roomName",value:this.state.roomName,onChange:this.handleChange}),o.a.createElement(te,null,o.a.createElement(ee,null,"Description:")),o.a.createElement($,{name:"description",value:this.state.description,onChange:this.handleChange,rows:4}))}}]),t}(a.Component),ae=Object(r.b)(function(e){return{auth:e.auth}},{tryCreateRoom:function(e,t){return function(n,a){console.log("Attempting to create room...");var o={name:e.name};return S.collection("rooms").get().then(function(a){var r=[];return a.forEach(function(e){console.log(e);var t=e.data();r.push(Object(j.a)({},t))}),r.find(function(e){return e.name===o.name})?t("Room name not available!"):S.collection("rooms").add(o).then(function(t){return S.collection("rooms/".concat(t.id,"/people")).doc(e.people.id).set(e.people).then(function(){S.collection("users/".concat(e.people.id,"/rooms")).doc(t.id).set({roomName:o.name}),n(R(Object(j.a)({id:t.id},e,{people:[e.people]}))),e.people.name})})})}}})(ne);n(347);function oe(){var e=Object(h.a)(["\n\tpadding-left: 10px;\n\tcolor: rgba(255, 255, 255, 0.65);\n\tbackground: none;\n\tborder: none;\n\ttransition: color 1s;\n\tcursor: pointer;\n\t&:hover {\n\t\tcolor: #fff;\n\t}\n"]);return oe=function(){return e},e}function re(){var e=Object(h.a)(["\n\ttext-align: center;\n\tpadding: 15px;\n"]);return re=function(){return e},e}var ie=b.a.Sider,se=g.a.div(re()),ce=g.a.button(oe()),le=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).state={isCreateRoomDialogOpen:!1},n.handleCloseCreateChatDialog=function(){n.setState({isCreateRoomDialogOpen:!1})},n.handleOpenCreateChatDialog=function(){n.setState({isCreateRoomDialogOpen:!0})},n.handleRoomSelect=function(e){var t=e.key;n.props.history.push(t)},n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.props.tryLogin()}},{key:"componentWillUpdate",value:function(e){!this.props.auth.uid&&e.auth.uid&&this.props.initSlacker()}},{key:"render",value:function(){return o.a.createElement(b.a,{style:{height:"100%"}},o.a.createElement(ie,{style:{overflow:"auto",height:"100vh",position:"fixed",left:0}},o.a.createElement(se,null,o.a.createElement(v.a,{icon:"plus",type:"primary",onClick:this.handleOpenCreateChatDialog},"Create room")),o.a.createElement(ae,{isOpen:this.state.isCreateRoomDialogOpen,handleClose:this.handleCloseCreateChatDialog}),o.a.createElement(ce,null,o.a.createElement("span",null,"Rooms:")),o.a.createElement(O.b,{theme:"dark",mode:"inline",onSelect:this.handleRoomSelect,defaultSelectedKeys:[this.props.location.pathname]},this.props.rooms.map(function(e){return o.a.createElement(O.b.Item,{key:"/r/".concat(e.id)},o.a.createElement("span",{className:"nav-text"},"# ",e.name))}))),o.a.createElement(b.a,{style:{marginLeft:200}},o.a.createElement(s.c,null,o.a.createElement(s.a,{path:"/r/:roomId",component:H}),o.a.createElement(s.a,{path:"/"},o.a.createElement("div",null,"No chat selected")))))}}]),t}(a.Component),ue=Object(r.b)(function(e){return{auth:e.auth,rooms:e.rooms}},{tryLogin:function(){return function(e){return C.auth().signInAnonymously().then(function(t){var n=t.user;if(n){var a=n.displayName||"Ninja";return e(function(e,t){return{type:"LOGIN",uid:e,displayName:t}}(n.uid,a))}}).catch(function(e){console.log({error:e}),e.code,e.message})}},initSlacker:function(){return function(e,t){var n=t().auth.uid;if(n)return S.collection("users").doc(n).collection("rooms").get().then(function(t){t.empty||t.forEach(function(t){var n=S.collection("rooms").doc(t.id);n.get().then(function(t){if(t.exists){var a=t.data(),o=[],r=[];n.collection("people").get().then(function(e){e.forEach(function(e){o.push(e.data())}),console.log({people:o})}).then(function(){n.collection("messages").get().then(function(t){var i;t.forEach(function(e){r.push(Object(j.a)({id:e.id},e.data()))}),r.sort(k),console.log({messages:r}),e(R({id:n.id,name:a?a.name:"Error",people:o,messages:r})),e((i=n.id,function(e,t){return S.collection("rooms/".concat(i,"/messages")).onSnapshot(function(n){t().rooms.find(function(e){return e.id===i})&&S.collection("rooms/".concat(i,"/people")).get().then(function(t){var a=[];n.forEach(function(e){a.push(Object(j.a)({id:e.id},e.data()))}),console.log("listener -> ",{messages:a}),a.sort(k),e(A(a,i))})})}))})})}})})})}}})(le),me=n(60),pe=n(199),de=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":return{uid:t.uid,displayName:t.displayName};case"LOGOUT":return{};default:return e}},fe=n(88),he=[],ge=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:he,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CREATE_ROOM":return[].concat(Object(fe.a)(e),[t.room]);case"JOIN_ROOM":return e.map(function(e){return e.name===t.roomName?Object(j.a)({},e,{people:[].concat(Object(fe.a)(e.people),[t.person])}):e});case"ON_LEFT":return e.map(function(e){if(e.name===t.roomName){var n=e.people.filter(function(e){return e.id!==t.personID});return Object(j.a)({},e,{people:n})}return e});case"ON_JOINED":return e.map(function(e){return e.name===t.roomName?(e.people.push(t.person),e):e});case"SEND_MESSAGE":return e.map(function(e){return e.name===t.roomName?Object(j.a)({},e,{messages:[].concat(Object(fe.a)(e.messages),[t.message])}):e});case"UPDATE_MESSAGES":return e.map(function(e){return e.id===t.roomId?Object(j.a)({},e,{messages:Object(fe.a)(t.messages)}):e});case"ORDER_ROOMS_START_STATE":return e.sort(function(e,t){return N()(e.messages[e.messages.length-1].createdAt)<N()(t.messages[t.messages.length-1].createdAt)?1:-1}),e.map(function(e){return e});case"CLEAR_UNREAD":return e.map(function(e){if(e.name===t.roomName){var n=e.people.map(function(e){return e.id===t.uid?Object(j.a)({},e,{unread:t.unread,lastRead:t.time}):e});return Object(j.a)({},e,{people:n})}return e});case"LEAVE_ROOM":return e.filter(function(e){return e.name!==t.roomName});case"CLEAR_STATE":return[];default:return e}},be=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||me.d,ve=Object(me.e)(Object(me.c)({auth:de,rooms:ge}),be(Object(me.a)(pe.a))),Oe=o.a.createElement(r.a,{store:ve},o.a.createElement(i.a,null,o.a.createElement(s.a,{path:"/",component:ue})));l.a.render(Oe,document.getElementById("container"))}},[[202,1,2]]]);
//# sourceMappingURL=main.1ab3f73e.chunk.js.map