(window.webpackJsonpkami=window.webpackJsonpkami||[]).push([[0],{169:function(e,t,n){e.exports=n(269)},267:function(e,t,n){},269:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(28),c=n(120),i=n(60),s=n(6),u=n.n(s),l=(n(178),n(31)),p=n(32),f=n(35),d=n(33),m=n(36),h=n(18),b=n(19),g=n(275),O=n(13),v=n(279),y=n(52),j=n(148),E=n.n(j),x=n(272);function w(){var e=Object(h.a)(["\n\tcolor: black;\n\tfont-weight: bold;\n\tmargin-top: 2px;\n"]);return w=function(){return e},e}function k(){var e=Object(h.a)(["\n\tcolor: black;\n"]);return k=function(){return e},e}function P(){var e=Object(h.a)(["\n\twidth: 46px;\n\tpadding: 5px;\n"]);return P=function(){return e},e}function C(){var e=Object(h.a)(["\n\tdisplay: flex;\n\tflex-direction: row;\n\tmargin-bottom: 2px;\n"]);return C=function(){return e},e}var D=b.a.div(C()),S=b.a.div(P()),R=b.a.div(k()),A=b.a.div(w()),I=function(e){var t=e.children,n=e.name;return e.isConsecutive?a.a.createElement(D,null,a.a.createElement(S,null),a.a.createElement(R,null,t)):a.a.createElement(D,null,a.a.createElement(S,null,a.a.createElement(x.a,{size:35,shape:"square",icon:"user"})),a.a.createElement(R,null,a.a.createElement(A,null,n),t))},T=n(24),M=n(67),L=n.n(M),_=(n(140),n(154)),N=n.n(_),B=L.a.initializeApp({apiKey:"AIzaSyB2tCxT6yP0CWtCbD9JDj3ZKaxxW8T25PI",authDomain:"slacker-c3b01.firebaseapp.com",databaseURL:"https://slacker-c3b01.firebaseio.com",projectId:"slacker-c3b01",storageBucket:"slacker-c3b01.appspot.com",messagingSenderId:"286218247810"}),U=new N.a(B),G=L.a.firestore(),J=new L.a.auth.GithubAuthProvider,V=new L.a.auth.GoogleAuthProvider,z=L.a.auth(),F=n(79),H=n.n(F),K="UPDATE_ROOM_PRESENCES",W="FETCH_MORE_MESSAGES",q="JOIN_ROOM_SAGA",X="INIT_SLACKER_SAGA";function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(n,!0).forEach(function(t){Object(T.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Q=function(e){var t=e.id,n=e.name,r=e.people,a=e.messages;return{type:"UPDATE_ROOM",room:{id:t,name:n,people:r,messages:void 0===a?[]:a,canFetchMore:e.canFetchMore,messageCount:e.messageCount}}},$=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(r,a){var o=a().auth;if(o){var c={sender:{uid:o.uid,displayName:o.displayName},text:e,createdAt:H()().format(),status:n};return G.collection("rooms/".concat(t,"/messages")).add(c)}}},ee=function(e){return{type:"UPDATE_AVAILABLE_ROOMS",rooms:e}},te=function(e){return{type:"ERROR_MESSAGE",message:e}},ne=function(e,t){var n={};return e.forEach(function(e){n[e.id]=Z({id:e.id},e.data())}),re(n,t)},re=function(e,t){return{type:"UPDATE_MESSAGES",messages:e,roomId:t}};function ae(){var e=Object(h.a)(["\n\tflex-shrink: 0;\n\tpadding: 0px 15px;\n\tbackground: none;\n\tborder: none;\n"]);return ae=function(){return e},e}function oe(){var e=Object(h.a)(["\n\tpadding-left: 14px;\n\tborder: none;\n\tborder-radius: 4px;\n\tflex-grow: 1;\n\toutline: none;\n"]);return oe=function(){return e},e}function ce(){var e=Object(h.a)(["\n\theight: 44px;\n\tbackground-color: #fff;\n\tborder-radius: 4px;\n\tborder: 1px solid #acacac;\n\tdisplay: flex;\n\tflex-direction: row;\n\tflex-shrink: 0;\n"]);return ce=function(){return e},e}var ie=b.a.form(ce()),se=b.a.input(oe()),ue=b.a.button(ae()),le=function(e){function t(){var e,n;Object(l.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(f.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).state={value:""},n.handleTyping=function(e){n.setState({value:e.target.value})},n.handleSend=function(e){e.preventDefault();var t=n.props.room,r=n.state.value;t&&t.id&&r.length>0&&(n.props.trySendMessage(r,t.id),n.setState({value:""}))},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return a.a.createElement(ie,{onSubmit:this.handleSend},a.a.createElement(se,{value:this.state.value,onChange:this.handleTyping}),a.a.createElement(ue,{type:"submit"},"Send"))}}]),t}(r.Component),pe=Object(o.b)(null,{trySendMessage:$})(le);function fe(){var e=Object(h.a)(["\n\tfloat: left;\n\tclear: both;\n"]);return fe=function(){return e},e}function de(){var e=Object(h.a)(["\n\twidth: 100%;\n\theight: 60px;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n"]);return de=function(){return e},e}function me(){var e=Object(h.a)(["\n\tpadding-top: 8px;\n\tpadding-bottom: 8px;\n\tflex-grow: 1;\n\toverflow-y: scroll;\n\toverflow-x: hidden;\n"]);return me=function(){return e},e}function he(){var e=Object(h.a)(["\n\t/* height: 100%; */\n\twidth: 100%;\n\tpadding: 24;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: '#fff';\n"]);return he=function(){return e},e}var be=b.a.div(he()),ge=b.a.div(me()),Oe=b.a.div(de()),ve=b.a.div(fe()),ye=function(e){var t=e.room,n=e.messages,r=e.getMessagesRef,o=e.getBottomAnchorRef,c=e.onLoadMoreVisibilityChange;return a.a.createElement(be,null,a.a.createElement(ge,{ref:r},a.a.createElement(Oe,null,a.a.createElement(E.a,{onChange:c},a.a.createElement(y.a,null,"Load more"))),n.map(function(e,t){return a.a.createElement(I,{isConsecutive:!!n[t-1]&&n[t-1].sender.uid===e.sender.uid,name:e.sender.displayName||"",key:e.id},e.text)}),a.a.createElement(ve,{ref:o})),a.a.createElement(pe,{room:t}))},je=n(277),Ee=n(278),xe=n(273),we=n(274),ke=function(e){return{type:"LOGIN",error:e}},Pe=function(){return function(e){return z.signInAnonymously().then(function(){}).catch(function(t){return console.log({error:t}),e(ke({error:t}))})}};function Ce(){var e=Object(h.a)(["\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: center;\n\talign-items: center;\n"]);return Ce=function(){return e},e}var De=je.a.Title,Se=b.a.div(Ce()),Re=function(e){function t(){var e,n;Object(l.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(f.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).handleTryLogin=function(e){n.props.tryLoginProvider(e).then(function(){n.props.handleClose()})},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this;return a.a.createElement(Ee.a,{title:"Profile",visible:this.props.isOpen,onOk:this.props.handleClose,onCancel:this.props.handleClose,okButtonProps:{disabled:!this.props.auth.uid},cancelButtonProps:{disabled:!this.props.auth.uid}},a.a.createElement("div",null,a.a.createElement(De,{level:4},"Login with"),a.a.createElement(xe.a,null,a.a.createElement(we.a,{span:24},a.a.createElement(Se,null,a.a.createElement(y.a,{onClick:function(){return e.handleTryLogin("github")},style:{margin:5}},a.a.createElement(O.a,{style:{fontSize:24},type:"github"})),a.a.createElement(y.a,{onClick:function(){return e.handleTryLogin("google")}},a.a.createElement(O.a,{style:{fontSize:24},type:"google"})))))))}}]),t}(r.Component),Ae=Object(o.b)(function(e){return{auth:e.auth}},{tryLoginProvider:function(e){return function(t){var n=null;if("github"===e)n=J;else{if("google"!==e)return Promise.reject("Invalid auth provider");n=V}return z.signInWithPopup(n).then(function(e){var n=e.user;if(console.log({user:n}),n)return t({type:"UPDATE_USER_ROOM_PRESENCE"})}).catch(function(e){return console.log({error:e}),t(ke({error:e}))})}}})(Re);function Ie(){var e=Object(h.a)(["\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n"]);return Ie=function(){return e},e}function Te(){var e=Object(h.a)(["\n\tbackground: none;\n\tborder: 1px solid transparent;\n\tborder-radius: 4px;\n\ttransition: border 0.5s;\n\toutline: none;\n\tpadding: 0px;\n\tline-height: normal;\n\tcursor: pointer;\n"]);return Te=function(){return e},e}var Me=g.a.Header,Le=je.a.Title,_e=b.a.button(Te()),Ne=b.a.div(Ie()),Be=function(e){function t(){var e,n;Object(l.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(f.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).state={profileOpen:!1},n.handleProfileOpen=function(){n.setState({profileOpen:!0})},n.handleProfileClose=function(){n.setState({profileOpen:!1})},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.props,t=e.room,n=e.uid,r=e.photoURL;return a.a.createElement(Me,{style:{background:"#fff",borderBottom:"1px solid #acacac",padding:16,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"}},a.a.createElement(Le,{style:{margin:0},level:3},"# ",t?t.name:""),!!n&&a.a.createElement(Ne,null,a.a.createElement(y.a,{icon:"setting",shape:"circle",style:{paddingTop:1,marginRight:10}}),a.a.createElement(_e,{onClick:this.handleProfileOpen},a.a.createElement(x.a,{src:r,size:35,shape:"square"})),a.a.createElement(Ae,{isOpen:this.state.profileOpen,handleClose:this.handleProfileClose})))}}]),t}(r.Component),Ue=Object(o.b)(function(e){var t=e.auth;return{uid:t.uid,photoURL:t.photoURL}})(Be),Ge=n(159);function Je(){var e=Object(h.a)(["\n\twidth: 100%;\n\tpadding: 24;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: '#fff';\n\tjustify-content: center;\n\talign-items: center;\n"]);return Je=function(){return e},e}var Ve=b.a.div(Je()),ze=function(){return a.a.createElement(Ve,null,a.a.createElement(Ge.a,{size:"large"}))},Fe=g.a.Content,He=function(e){var t=e.room,n=e.children,o=e.isLoading;return a.a.createElement(r.Fragment,null,a.a.createElement(Ue,{room:t}),a.a.createElement(Fe,{style:{margin:"0px 16px 24px 16px",overflow:"initial",display:"flex"}},o?a.a.createElement(ze,null):n))},Ke=n(161),We=function(e,t){return new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()},qe=function(e){return function(t){var n=t.rooms.active[e];return Object.values(n.messages).sort(We)[0]||null}},Xe=Object(Ke.a)(function(e,t){var n=t.match.params.roomId;return e.rooms.active[n]},function(e,t){var n=t.match.params.roomId,r=e.rooms.active[n];return r?Object.values(r.messages).sort(We):[]},function(e){return e.auth},function(e,t,n){return{auth:n,room:e,messages:t,isLoading:!e}}),Ye=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(f.a)(this,Object(d.a)(t).call(this,e))).messagesEnd=null,n.messagesContainer=null,n.scrollToBottom=function(){n.messagesEnd&&n.messagesEnd.scrollIntoView({behavior:"auto"})},n.handleLoadMoreVisibilityChange=function(e){var t=n.props.room;e&&!1===n.state.loadMoreVisible&&t&&(console.log("load more messages"),n.props.tryFetchMoreMessages(t.id)),n.setState({loadMoreVisible:e})},n.state={loadMoreVisible:null},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(e){if(0===e.messages.length&&this.props.messages.length>0)this.scrollToBottom();else if(e.room&&this.props.room&&e.room.id!==this.props.room.id)this.scrollToBottom();else if(e.messages.length!==this.props.messages.length&&e.messages.length>0&&this.props.messages.length>0){var t=e.messages.slice(-1)[0],n=this.props.messages.slice(-1)[0];if(t.id!==n.id&&n&&n.sender.uid===this.props.auth.uid)this.scrollToBottom();else if(this.messagesContainer){var r=this.messagesContainer,a=r.scrollHeight,o=r.scrollTop,c=r.clientHeight;Math.abs(c-(a-o-45))<45&&this.scrollToBottom()}}}},{key:"render",value:function(){var e=this,t=this.props,n=t.room,r=t.messages,o=t.isLoading;return a.a.createElement(He,{room:n,isLoading:o},a.a.createElement(ye,{room:n,messages:r,onLoadMoreVisibilityChange:this.handleLoadMoreVisibilityChange,getMessagesRef:function(t){return e.messagesContainer=t},getBottomAnchorRef:function(t){return e.messagesEnd=t}}))}}]),t}(r.Component),Ze=Object(o.b)(function(e,t){return Xe(e,t)},{trySendMessage:$,tryFetchMoreMessages:function(e){return{type:W,roomId:e}}})(Ye),Qe=n(280);function $e(){var e=Object(h.a)(["\n\tmargin-top: 5px;\n\tmargin-bottom: 5px;\n"]);return $e=function(){return e},e}var et=Qe.a.TextArea,tt=je.a.Text,nt=b.a.div($e()),rt=function(e){function t(){var e,n;Object(l.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(f.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).state={roomName:"",description:""},n.handleChange=function(e){console.log(e.target.name),n.setState(Object(T.a)({},e.target.name,e.target.value))},n.handleSubmit=function(){var e=n.props.auth,t=e.uid,r=e.displayName;if(t){console.log("Create this room pls");var a=n.state.roomName;if(a&&a.length>0){var o={name:a,people:{id:t,name:r,unread:0,lastRead:0}};n.props.tryCreateRoom(o),n.props.handleClose()}}},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return a.a.createElement(Ee.a,{title:"Create Room",visible:this.props.isOpen,onOk:this.handleSubmit,onCancel:this.props.handleClose,okButtonProps:{disabled:!this.props.auth.uid},cancelButtonProps:{disabled:!this.props.auth.uid}},a.a.createElement(nt,null,a.a.createElement(tt,null,"Name:")),a.a.createElement(Qe.a,{name:"roomName",value:this.state.roomName,onChange:this.handleChange}),a.a.createElement(nt,null,a.a.createElement(tt,null,"Description:")),a.a.createElement(et,{name:"description",value:this.state.description,onChange:this.handleChange,rows:4}))}}]),t}(r.Component),at=Object(o.b)(function(e){return{auth:e.auth}},{tryCreateRoom:function(e,t){return function(n,r){var a={name:e.name};return G.collection("rooms").get().then(function(o){var c=[];return o.forEach(function(e){console.log(e);var t=e.data();c.push(Z({},t))}),c.find(function(e){return e.name===a.name})?t("Room name not available!"):G.collection("rooms").add(a).then(function(t){return G.collection("rooms/".concat(t.id,"/people")).doc(e.people.id).set(e.people).then(function(){G.collection("users/".concat(e.people.id,"/rooms")).doc(t.id).set({roomName:a.name}),n(Q(Z({id:t.id},e,{people:[e.people]})));var o=r().auth;o&&$("".concat(o.displayName," created this room"),t.id)})})})}}})(rt),ot=n(276);function ct(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function it(){var e=Object(h.a)(["\n\tpadding: 10px;\n"]);return it=function(){return e},e}var st=b.a.div(it()),ut=function(e){function t(){var e,n;Object(l.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(f.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).handleJoinRoom=function(e){if(!e.canJoin)return console.log("redirect to that room"),void n.props.handleClose();n.props.tryJoinRoom(e.id)},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this;return a.a.createElement(Ee.a,{title:"Browse Rooms",visible:this.props.isOpen,onOk:this.props.handleClose,onCancel:this.props.handleClose,okButtonProps:{disabled:!this.props.auth.uid},cancelButtonProps:{disabled:!this.props.auth.uid},bodyStyle:{maxHeight:450,overflowY:"scroll"}},a.a.createElement(ot.a,{dataSource:this.props.roomList,renderItem:function(t){return a.a.createElement(ot.a.Item,{key:t.id},a.a.createElement(ot.a.Item.Meta,{avatar:t.avatarUrl?a.a.createElement(x.a,{src:t.avatarUrl}):null,title:a.a.createElement("button",{onClick:function(){return e.handleJoinRoom(t)}},t.name),description:"TODO room descriptions"}),a.a.createElement("div",null,t.canJoin?a.a.createElement(y.a,{onClick:function(){return e.handleJoinRoom(t)}},"Join"):a.a.createElement(st,null,"Active")))}}," "))}}]),t}(r.Component),lt=Object(o.b)(function(e){var t=e.rooms,n=t.available,r=t.active;return{roomList:Object.values(n).map(function(e){var t=void 0===Object.values(r).find(function(t){return t.id===e.id});return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ct(n,!0).forEach(function(t){Object(T.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ct(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e,{canJoin:t})}),auth:e.auth}},{tryJoinRoom:function(e){return{type:q,roomId:e}}})(ut);n(267);function pt(){var e=Object(h.a)(["\n\theight: 100%;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n"]);return pt=function(){return e},e}function ft(){var e=Object(h.a)(["\n\tfont-size: 16px;\n\tbackground: none;\n\tborder: none;\n\t-webkit-transition: color 0.5s;\n\ttransition: color 0.5s;\n\tcursor: pointer;\n\t&:hover {\n\t\tcolor: #fff;\n\t}\n"]);return ft=function(){return e},e}function dt(){var e=Object(h.a)(["\n\tpadding: 10px;\n\tcolor: rgba(255, 255, 255, 0.65);\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n"]);return dt=function(){return e},e}function mt(){var e=Object(h.a)(["\n\theight: 100%;\n"]);return mt=function(){return e},e}function ht(){var e=Object(h.a)(["\n\ttext-align: center;\n\tpadding: 10px;\n\theight: 64px;\n\tborder-bottom: 1px solid grey;\n"]);return ht=function(){return e},e}var bt=g.a.Sider,gt=b.a.div(ht()),Ot=b.a.img(mt()),vt=b.a.div(dt()),yt=b.a.button(ft()),jt=b.a.div(pt()),Et=function(e){function t(){var e,n;Object(l.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(f.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).state={openDialog:!1},n.handleCloseDialog=function(){n.setState({openDialog:!1})},n.handleOpenDialog=function(e){n.setState({openDialog:e})},n.handleRoomSelect=function(e){var t=e.key;n.props.history.push(t)},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.props.initAuth()}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.location,r=t.activeRooms,a=t.history;"/"===n.pathname&&0===e.activeRooms.length&&0!==r.length&&a.push("/r/".concat(r[0].id)),!e.auth.uid&&this.props.auth.uid&&this.props.initSlacker()}},{key:"render",value:function(){var e=this;return a.a.createElement(g.a,{style:{height:"100%"}},a.a.createElement(bt,{style:{overflow:"auto",height:"100vh",position:"fixed",left:0}},a.a.createElement(gt,null,a.a.createElement(Ot,{src:"fox.png"})),a.a.createElement(vt,null,a.a.createElement(yt,{onClick:function(){return e.handleOpenDialog("browseRooms")}},a.a.createElement("span",null,"Rooms:")),a.a.createElement(yt,{onClick:function(){return e.handleOpenDialog("createRoom")}},a.a.createElement(O.a,{type:"plus-circle"}))),a.a.createElement(at,{isOpen:"createRoom"===this.state.openDialog,handleClose:this.handleCloseDialog}),a.a.createElement(lt,{isOpen:"browseRooms"===this.state.openDialog,handleClose:this.handleCloseDialog}),a.a.createElement(v.a,{theme:"dark",mode:"inline",onSelect:this.handleRoomSelect,selectedKeys:[this.props.location.pathname]},this.props.activeRooms.map(function(e){return a.a.createElement(v.a.Item,{key:"/r/".concat(e.id)},a.a.createElement("span",{className:"nav-text"},"# ",e.name))}))),a.a.createElement(g.a,{style:{marginLeft:200,background:"#fff"}},a.a.createElement(i.c,null,a.a.createElement(i.a,{path:"/r/:roomId",component:Ze}),a.a.createElement(i.a,{path:"/"},a.a.createElement(jt,null,0===this.props.activeRooms.length?a.a.createElement(ze,null):a.a.createElement("div",null,"No chat selected"))))))}}]),t}(r.Component),xt=Object(o.b)(function(e){return{auth:e.auth,activeRooms:Object.values(e.rooms.active),availableRooms:Object.values(e.rooms.available)}},{initAuth:function(){return function(e){return z.onAuthStateChanged(function(t){if(t){if(t){var n={displayName:t.displayName||"Ninja",email:t.email,photoURL:t.photoURL};return e(function(e,t){return{type:"LOGIN",uid:e,userData:t}}(t.uid,n))}}else Pe()(e)})}},initSlacker:function(){return{type:X}}})(Et),wt=n(47),kt=n(163),Pt=n(73);function Ct(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Dt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ct(n,!0).forEach(function(t){Object(T.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ct(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function St(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?St(n,!0).forEach(function(t){Object(T.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):St(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var At={active:{},available:{}},It=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_ROOM":case"ACTIVE_ROOM":return Rt({},e,{active:Rt({},e.active,Object(T.a)({},t.room.id,Rt({},e.active[t.room.id],{},t.room)))});case"UPDATE_AVAILABLE_ROOMS":return Rt({},e,{available:Rt({},t.rooms.reduce(function(e,t){return Rt({},e,Object(T.a)({},t.id,t))},{}))});case"SEND_MESSAGE":return Rt({},e,{active:Rt({},e.active,Object(T.a)({},t.roomId,Rt({},[e.active[t.roomId]],{messages:Rt({},e.active[t.roomId].messages,Object(T.a)({},t.message.id,t.message))})))});case"UPDATE_MESSAGES":return Rt({},e,{active:Rt({},e.active,Object(T.a)({},t.roomId,Rt({},e.active[t.roomId],{messages:Rt({},e.active[t.roomId].messages,{},t.messages)})))});default:return e}},Tt=Object(wt.c)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":return Dt({uid:t.uid},t.userData);case"LOGOUT":return{};default:return e}},rooms:It,redirect:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REDIRECT_TO":return{redirectTo:t.redirectTo};default:return e}}}),Mt=n(16),Lt=n.n(Mt),_t=n(165),Nt=n(14),Bt=n(164),Ut=Lt.a.mark(Yt),Gt=Lt.a.mark(Zt),Jt=Lt.a.mark(Qt),Vt=Lt.a.mark($t),zt=Lt.a.mark(en),Ft=Lt.a.mark(tn),Ht=Lt.a.mark(nn),Kt=Lt.a.mark(rn),Wt=Lt.a.mark(an);function qt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Xt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qt(n,!0).forEach(function(t){Object(T.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qt(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Yt(){var e,t,n,r,a;return Lt.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Object(Nt.select)(function(e){return e.auth});case 2:return e=o.sent,e.uid,t=Object(Bt.a)(e,["uid"]),o.next=6,Object(Nt.call)(U.firestore.getCollection,"users/".concat(e.uid,"/rooms"));case 6:if((n=o.sent).empty){o.next=17;break}r=[],n.forEach(function(e){r.push(e.id)}),o.t0=Lt.a.keys(r);case 11:if((o.t1=o.t0()).done){o.next=17;break}return a=o.t1.value,o.next=15,Object(Nt.call)(U.firestore.setDocument,"rooms/".concat(a,"/people/").concat(e.uid),Xt({id:e.uid},t));case 15:o.next=11;break;case 17:case"end":return o.stop()}},Ut)}function Zt(e){var t,n,r,a,o,c,i,s,u;return Lt.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return t=e.roomId,l.next=3,Object(Nt.select)(function(e){return e.auth});case 3:return n=l.sent,r=n.uid,a=n.displayName,o=n.photoURL,c=G.doc("rooms/".concat(t)),l.next=10,Object(Nt.call)(U.firestore.getDocument,c);case 10:if(i=l.sent,(s=Xt({id:i.id},i.data()))&&i.exists){l.next=18;break}return l.next=15,Object(Nt.put)(te("Room not found!"));case 15:return l.abrupt("return");case 18:if(!s.people||!s.people.find(function(e){return e.id===r})){l.next=22;break}return l.abrupt("return");case 22:return u={name:a,photoURL:o,id:r,unread:0,lastRead:0},l.next=25,Object(Nt.call)(U.firestore.setDocument,"rooms/".concat(t,"/people/").concat(u.id),u);case 25:return l.next=27,Object(Nt.call)(U.firestore.setDocument,"users/".concat(u.id,"/rooms/").concat(t),{roomName:s.name});case 27:return l.next=29,Object(Nt.call)($t,t);case 29:case"end":return l.stop()}},Gt)}function Qt(e,t){var n,r;return Lt.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n={},r=e.collection("messages").orderBy("createdAt","desc").limit(35),t&&(r=r.startAfter(t)),a.next=5,Object(Nt.call)(U.firestore.getCollection,r);case 5:return a.sent.forEach(function(e){n[e.id]=Xt({id:e.id},e.data())}),a.abrupt("return",n);case 8:case"end":return a.stop()}},Jt)}function $t(e){var t,n,r,a,o,c;return Lt.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return console.log("try fetch room ",e),t=G.collection("rooms").doc(e),i.next=4,Object(Nt.call)(U.firestore.getDocument,t);case 4:if(!(n=i.sent).exists){i.next=20;break}return r=n.data(),a=[],i.next=10,Object(Nt.call)(U.firestore.getCollection,t.collection("people"));case 10:return i.sent.forEach(function(e){a.push(Xt({id:e.id},e.data()))}),i.next=14,Object(Nt.call)(Qt,t);case 14:return o=i.sent,c=35===Object.keys(o).length,i.next=18,Object(Nt.put)(Q({id:t.id,name:r?r.name:"Error",people:a,messages:o,canFetchMore:c}));case 18:return i.next=20,Object(Nt.call)(en,t);case 20:case"end":return i.stop()}},Vt)}function en(e){var t;return Lt.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.collection("messages").orderBy("createdAt","desc").limit(1),n.next=3,Object(Nt.fork)(U.firestore.syncCollection,t,{successActionCreator:function(t){return ne(t,e.id)}});case 3:case"end":return n.stop()}},zt)}function tn(e){var t,n,r,a;return Lt.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.roomId,console.log("try fetch room ",t),n=G.collection("rooms").doc(t),o.next=5,Object(Nt.call)(U.firestore.getDocument,n);case 5:if(!o.sent.exists){o.next=17;break}return o.next=9,Object(Nt.select)(qe(t));case 9:return r=o.sent,console.log({earliestMessage:r}),o.next=13,Object(Nt.call)(Qt,n,r.createdAt);case 13:return a=o.sent,console.log({messages:a}),o.next=17,Object(Nt.put)(re(a,t));case 17:case"end":return o.stop()}},Ft)}function nn(){return Lt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Nt.takeEvery)(W,tn);case 2:case"end":return e.stop()}},Ht)}function rn(){return Lt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Nt.takeEvery)(q,Zt);case 2:case"end":return e.stop()}},Kt)}function an(){return Lt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Nt.takeEvery)(K,Yt);case 2:case"end":return e.stop()}},Wt)}var on=[rn(),an(),nn()],cn=Lt.a.mark(pn),sn=Lt.a.mark(fn);function un(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ln(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?un(n,!0).forEach(function(t){Object(T.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):un(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function pn(e){var t,n,r,a,o,c,i,s,u,l;return Lt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Nt.select)(function(e){return e.auth});case 2:if((t=e.sent).uid){e.next=6;break}return console.log("no auth!"),e.abrupt("return");case 6:return n=G.collection("rooms").get(),e.next=9,n;case 9:return r=e.sent,a=[],r.forEach(function(e){var t=ln({id:e.id},e.data());a.push(t)}),e.next=14,Object(Nt.put)(ee(a));case 14:return o=a.find(function(e){return"general"===e.name}),e.next=17,Object(Nt.call)(U.firestore.getCollection,"users/".concat(t.uid,"/rooms"));case 17:if((c=e.sent).empty){e.next=34;break}i=[],c.forEach(function(e){return i.push(e.id)}),s=0,u=i;case 22:if(!(s<u.length)){e.next=29;break}return l=u[s],e.next=26,Object(Nt.fork)($t,l);case 26:s++,e.next=22;break;case 29:if(!o||i.includes(o.id)){e.next=32;break}return e.next=32,Object(Nt.put)({type:q,roomId:o.id,room:o});case 32:e.next=37;break;case 34:if(!o){e.next=37;break}return e.next=37,Object(Nt.put)({type:q,roomId:o.id,room:o});case 37:case"end":return e.stop()}},cn)}function fn(){return Lt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Nt.takeLatest)(X,pn);case 2:case"end":return e.stop()}},sn)}var dn=fn,mn=Lt.a.mark(hn);function hn(){return Lt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Nt.all)([dn()].concat(Object(_t.a)(on)));case 2:case"end":return e.stop()}},mn)}var bn=Object(Pt.default)(),gn=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||wt.d,On=function(){var e=Object(wt.e)(Tt,gn(Object(wt.a)(kt.a,bn)));return bn.run(hn),e}(),vn=a.a.createElement(o.a,{store:On},a.a.createElement(c.a,null,a.a.createElement(i.a,{path:"/",component:xt})));u.a.render(vn,document.getElementById("container"))}},[[169,1,2]]]);
//# sourceMappingURL=main.cc8e3adb.chunk.js.map