{"version":3,"sources":["components/LoadingSpinner.tsx","components/Message.tsx","firebase/firebase.ts","actions/rooms.ts","components/RoomContainer.tsx","components/CreateChatDialog.tsx","components/App.tsx","actions/auth.ts","reducers/rooms.ts","reducers/index.ts","reducers/auth.ts","reducers/redirect.ts","sagas/initSaga.ts","sagas/joinRoomSaga.ts","sagas/rootSaga.ts","store/configureStore.ts","index.tsx"],"names":["LoadingWrapper","styled","div","_templateObject","LoadingSpinner","react_default","a","createElement","spin","size","MessageLayout","Message_templateObject","LeftPanel","_templateObject2","RightPanel","_templateObject3","MessageHeader","_templateObject4","Message","_ref","children","name","isConsecutive","avatar","shape","icon","firebaseApp","firebase","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","rsf","ReduxSagaFirebase","database","firestore","byCreatedAt","b","Date","createdAt","createRoom","id","people","_ref$messages","messages","type","room","showError","message","updateMessages","roomId","availableRooms","rooms","syncMessages","messagesSnapshot","forEach","doc","push","Object","objectSpread","data","sort","Header","Layout","Content","Title","Typography","ChatWrapper","RoomContainer_templateObject","Messages","RoomContainer_templateObject2","InputForm","form","RoomContainer_templateObject3","Input","input","RoomContainer_templateObject4","SendButton","button","_templateObject5","RoomContainer","state","messageValue","messagesEnd","messagesContainer","handleTyping","e","_this","setState","target","value","scrollToBottom","scrollIntoView","behavior","handleSend","preventDefault","props","text","length","trySendMessage","this","match","params","console","log","prevProps","previousLastMessage","slice","currentLastMessage","sender","uid","auth","_this$messagesContain","scrollHeight","scrollTop","clientHeight","offsetHeight","Math","abs","_this2","_this$props","isLoading","content","components_LoadingSpinner","ref","el","map","idx","components_Message","displayName","key","style","float","clear","onSubmit","onChange","react","background","borderBottom","padding","display","flexDirection","alignItems","margin","level","overflow","Component","connect","ownProps","joined","find","status","arguments","undefined","dispatch","getState","user","moment","format","collection","concat","add","TextArea","Text","TextWrap","CreateChatDialog_templateObject","CreateChatDialog","roomName","description","handleChange","defineProperty","handleSubmit","_this$props$auth","userDisplayName","unread","lastRead","tryCreateRoom","handleClose","modal","title","visible","isOpen","onOk","onCancel","okButtonProps","disabled","cancelButtonProps","rows","roomData","showCreateError","get","then","snapshot","r","roomRef","set","Sider","ButtonWrap","App_templateObject","RoomButtons","App_templateObject2","App","isCreateRoomDialogOpen","handleCloseCreateChatDialog","handleOpenCreateChatDialog","handleRoomSelect","history","tryLogin","nextProps","initSlacker","location","pathname","layout","height","position","left","es_button","onClick","components_CreateChatDialog","menu","theme","mode","onSelect","defaultSelectedKeys","Item","className","marginLeft","react_router","path","component","signInAnonymously","response","loginSuccess","catch","error","code","defaultState","available","reducers","combineReducers","action","toConsumableArray","redirect","redirectTo","fetchRoomSaga","initSlackerSaga","mySaga","roomDoc","regenerator_default","wrap","_context","prev","next","call","getDocument","sent","exists","getCollection","peopleDoc","messageDoc","put","fork","syncCollection","successActionCreator","stop","_marked","roomsPromise","roomsQuery","generalRoom","userRoomsQuery","userRoomIds","_i","_userRoomIds","_context2","select","abrupt","empty","userRoomDoc","includes","_marked2","_context3","takeLatest","_marked3","joinRoom","joinRoomSaga","person","setDocument","joinRoomSaga_marked","takeEvery","joinRoomSaga_marked2","rootSaga","all","initSaga","rootSaga_marked","sagaMiddleware","createSagaMiddleware","composeEnhancers","window","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","applyMiddleware","thunk","run","configureStore","jsx","es","react_router_dom","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.9210c0d6.chunk.js","sourcesContent":["import React from 'react'\r\nimport styled from 'styled-components'\r\nimport { Spin } from 'antd'\r\n\r\nconst LoadingWrapper = styled.div`\r\n\theight: 100%;\r\n\tpadding: 24;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tbackground: '#fff';\r\n\tjustify-content: center;\r\n\talign-items: center;\r\n`\r\n\r\nconst LoadingSpinner = () => (\r\n\t<LoadingWrapper>\r\n\t\t<Spin size=\"large\" />\r\n\t</LoadingWrapper>\r\n)\r\n\r\nexport default LoadingSpinner\r\n","import React, { FunctionComponent } from 'react'\r\nimport { Avatar } from 'antd'\r\nimport styled from 'styled-components'\r\n\r\nconst MessageLayout = styled.div`\r\n\tdisplay: flex;\r\n\tflex-direction: row;\r\n\tmargin-bottom: 2px;\r\n`\r\n\r\nconst LeftPanel = styled.div`\r\n\twidth: 46px;\r\n\tpadding: 5px;\r\n`\r\n\r\n// const Avatar = styled.div`\r\n// \t/* width: 35px;\r\n// \theight: 35px;\r\n// \tmargin: 5px;\r\n// \tborder-radius: 2px;\r\n// \tbackground-color: #cecece;\r\n// ` */\r\n\r\nconst RightPanel = styled.div`\r\n\tcolor: black;\r\n`\r\n\r\nconst MessageHeader = styled.div`\r\n\tcolor: black;\r\n\tfont-weight: bold;\r\n\tmargin-top: 2px;\r\n`\r\n\r\ninterface Props {\r\n\tname: string\r\n\tisConsecutive?: boolean\r\n}\r\n\r\nconst Message: FunctionComponent<Props> = ({\r\n\tchildren,\r\n\tname,\r\n\tisConsecutive,\r\n}) => {\r\n\tif (isConsecutive) {\r\n\t\treturn (\r\n\t\t\t<MessageLayout>\r\n\t\t\t\t<LeftPanel />\r\n\t\t\t\t<RightPanel>{children}</RightPanel>\r\n\t\t\t</MessageLayout>\r\n\t\t)\r\n\t}\r\n\r\n\treturn (\r\n\t\t<MessageLayout>\r\n\t\t\t<LeftPanel>\r\n\t\t\t\t<Avatar size={35} shape=\"square\" icon=\"user\" />\r\n\t\t\t</LeftPanel>\r\n\t\t\t<RightPanel>\r\n\t\t\t\t<MessageHeader>{name}</MessageHeader>\r\n\t\t\t\t{children}\r\n\t\t\t</RightPanel>\r\n\t\t</MessageLayout>\r\n\t)\r\n}\r\n\r\nexport default Message\r\n","import firebase from 'firebase'\r\nimport '@firebase/firestore' // 👈 Don't forget this!\r\nimport ReduxSagaFirebase from 'redux-saga-firebase'\r\nconst config = {\r\n\tapiKey: 'AIzaSyB2tCxT6yP0CWtCbD9JDj3ZKaxxW8T25PI',\r\n\tauthDomain: 'slacker-c3b01.firebaseapp.com',\r\n\tdatabaseURL: 'https://slacker-c3b01.firebaseio.com',\r\n\tprojectId: 'slacker-c3b01',\r\n\tstorageBucket: 'slacker-c3b01.appspot.com',\r\n\tmessagingSenderId: '286218247810',\r\n}\r\nconst firebaseApp = firebase.initializeApp(config)\r\nconst rsf = new ReduxSagaFirebase(firebaseApp)\r\nconst database = firebase.firestore() // const githubAuthProvider = new firebase.auth.GithubAuthProvider();\r\nexport { firebase, rsf, database as default }\r\n","import database, { firebase } from '../firebase/firebase'\r\n// import { history } from \"../routers/AppRouter\";\r\nimport moment from 'moment'\r\nimport * as path from 'path'\r\n// import { ipcRenderer } from 'electron';\r\n\r\nconst byCreatedAt = function(a: any, b: any) {\r\n\t// @ts-ignore\r\n\treturn new Date(a.createdAt) - new Date(b.createdAt)\r\n}\r\n\r\nexport interface RoomData {\r\n\tid?: string;\r\n\tname: string;\r\n\tpeople: any;\r\n\tmessages?: any;\r\n}\r\n\r\nexport const createRoom = ({ id, name, people, messages = [] }: RoomData) => ({\r\n\ttype: 'CREATE_ROOM',\r\n\troom: {\r\n\t\tid,\r\n\t\tname,\r\n\t\tpeople,\r\n\t\tmessages,\r\n\t},\r\n})\r\n\r\nexport const joinedRoom = (joinedRoom: RoomItem) => ({\r\n\ttype: 'JOINED_ROOM',\r\n\tjoinedRoom\r\n})\r\n\r\nexport const tryCreateRoom = (roomData: RoomData, showCreateError: any) => {\r\n\treturn (dispatch: any, getState: () => StoreState) => {\r\n\t\tconst room = {\r\n\t\t\tname: roomData.name,\r\n\t\t}\r\n\t\t// get all rooms\r\n\t\treturn database\r\n\t\t\t.collection('rooms')\r\n\t\t\t.get()\r\n\t\t\t.then(snapshot => {\r\n\t\t\t\tconst rooms: Room[] = []\r\n\t\t\t\tsnapshot.forEach(doc => {\r\n\t\t\t\t\tconsole.log(doc)\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tconst room: Room = doc.data()\r\n\t\t\t\t\trooms.push({\r\n\t\t\t\t\t\t...room,\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t\t// if no room with this name\r\n\t\t\t\tif (!rooms.find(r => r.name === room.name)) {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\tdatabase\r\n\t\t\t\t\t\t\t.collection('rooms')\r\n\t\t\t\t\t\t\t.add(room)\r\n\t\t\t\t\t\t\t// create this room and\r\n\t\t\t\t\t\t\t.then(roomRef => {\r\n\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\tdatabase\r\n\t\t\t\t\t\t\t\t\t\t.collection(`rooms/${roomRef.id}/people`)\r\n\t\t\t\t\t\t\t\t\t\t.doc(roomData.people.id)\r\n\t\t\t\t\t\t\t\t\t\t// assign people to it?\r\n\t\t\t\t\t\t\t\t\t\t.set(roomData.people)\r\n\t\t\t\t\t\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\t\t\t\t\t\tdatabase\r\n\t\t\t\t\t\t\t\t\t\t\t\t.collection(`users/${roomData.people.id}/rooms`)\r\n\t\t\t\t\t\t\t\t\t\t\t\t.doc(roomRef.id)\r\n\t\t\t\t\t\t\t\t\t\t\t\t.set({ roomName: room.name })\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tdispatch(\r\n\t\t\t\t\t\t\t\t\t\t\t\tcreateRoom({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tid: roomRef.id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t...roomData,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpeople: [roomData.people],\r\n\t\t\t\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\tconst perName = roomData.people.name\r\n\t\t\t\t\t\t\t\t\t\t\t// dispatch(\r\n\t\t\t\t\t\t\t\t\t\t\t// \tstartSendMessage(\r\n\t\t\t\t\t\t\t\t\t\t\t// \t\t`${perName} created this room`,\r\n\t\t\t\t\t\t\t\t\t\t\t// \t\troom.name,\r\n\t\t\t\t\t\t\t\t\t\t\t// \t\ttrue,\r\n\t\t\t\t\t\t\t\t\t\t\t// \t),\r\n\t\t\t\t\t\t\t\t\t\t\t// ).then(() => {\r\n\t\t\t\t\t\t\t\t\t\t\t// \tdispatch(startListening(room.name))\r\n\t\t\t\t\t\t\t\t\t\t\t// \t// history.push(`/room/${room.name}`);\r\n\t\t\t\t\t\t\t\t\t\t\t// })\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t)\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn showCreateError('Room name not available!')\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t}\r\n}\r\n\r\nexport const startListening = (roomId: string) => {\r\n\treturn (dispatch: any, getState: () => StoreState) => {\r\n\t\treturn database\r\n\t\t\t.collection(`rooms/${roomId}/messages`)\r\n\t\t\t.onSnapshot(messagesQuery => {\r\n\t\t\t\tif (getState().rooms.joined.find(room => room.id === roomId)) {\r\n\t\t\t\t\tdatabase\r\n\t\t\t\t\t\t.collection(`rooms/${roomId}/people`)\r\n\t\t\t\t\t\t.get()\r\n\t\t\t\t\t\t.then(personQuery => {\r\n\t\t\t\t\t\t\tconst messages: any[] = []\r\n\t\t\t\t\t\t\tmessagesQuery.forEach(doc => {\r\n\t\t\t\t\t\t\t\tmessages.push({ id: doc.id, ...doc.data() })\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tconsole.log('listener -> ', { messages })\r\n\t\t\t\t\t\t\tmessages.sort(byCreatedAt)\r\n\t\t\t\t\t\t\treturn dispatch(updateMessages(messages, roomId))\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// dispatch(\r\n\t\t\t\t\t\t\t// \tsendMessage(\r\n\t\t\t\t\t\t\t// \t\t{\r\n\t\t\t\t\t\t\t// \t\t\t...message,\r\n\t\t\t\t\t\t\t// \t\t\tid: msgSnapshot ? msgSnapshot.key : 'nullSnap',\r\n\t\t\t\t\t\t\t// \t\t},\r\n\t\t\t\t\t\t\t// \t\troomName,\r\n\t\t\t\t\t\t\t// \t),\r\n\t\t\t\t\t\t\t// )\r\n\t\t\t\t\t\t\t// dispatch(orderRoomsStartState())\r\n\t\t\t\t\t\t\t// if (message.sender.displayName !== getState().auth.displayName) {\r\n\t\t\t\t\t\t\t// \t// ipcRenderer.send('playNotif', message.sender.displayName, message.text);\r\n\t\t\t\t\t\t\t// \tconst audio = new Audio('/sounds/notif.mp3')\r\n\t\t\t\t\t\t\t// \taudio.play()\r\n\t\t\t\t\t\t\t// }\r\n\t\t\t\t\t\t\t// const keyword =\r\n\t\t\t\t\t\t\t// \tmessage.status && message.text.split(' ').splice(-1, 1)[0]\r\n\t\t\t\t\t\t\t// if (keyword === 'left') {\r\n\t\t\t\t\t\t\t// \tdispatch(onLeft(roomName, message.sender.uid))\r\n\t\t\t\t\t\t\t// } else if (keyword === 'joined') {\r\n\t\t\t\t\t\t\t// \tdispatch(\r\n\t\t\t\t\t\t\t// \t\tonJoined(roomName, personSnapshot.val()[message.sender.uid]),\r\n\t\t\t\t\t\t\t// \t)\r\n\t\t\t\t\t\t\t// }\r\n\t\t\t\t\t\t\t// const personID = getState().auth.uid\r\n\r\n\t\t\t\t\t\t\t// if (personID === message.sender.uid && keyword !== 'left') {\r\n\t\t\t\t\t\t\t// \tdatabase\r\n\t\t\t\t\t\t\t// \t\t.ref(`rooms/${roomName}/people/${personID}`)\r\n\t\t\t\t\t\t\t// \t\t.update({ unread: 0, lastRead: message.createdAt })\r\n\t\t\t\t\t\t\t// \t\t.then(() => {\r\n\t\t\t\t\t\t\t// \t\t\tdispatch(\r\n\t\t\t\t\t\t\t// \t\t\t\tsetUnread(roomName, personID, message.createdAt, 0),\r\n\t\t\t\t\t\t\t// \t\t\t)\r\n\t\t\t\t\t\t\t// \t\t})\r\n\t\t\t\t\t\t\t// } else if (\r\n\t\t\t\t\t\t\t// \tpersonID !== message.sender.uid &&\r\n\t\t\t\t\t\t\t// \tmoment(message.createdAt) >\r\n\t\t\t\t\t\t\t// \t\tmoment(personSnapshot.val()[personID].lastRead)\r\n\t\t\t\t\t\t\t// ) {\r\n\t\t\t\t\t\t\t// \tdatabase\r\n\t\t\t\t\t\t\t// \t\t.ref(`rooms/${roomName}/people/${personID}`)\r\n\t\t\t\t\t\t\t// \t\t.update({\r\n\t\t\t\t\t\t\t// \t\t\tunread: personSnapshot.val()[personID].unread + 1,\r\n\t\t\t\t\t\t\t// \t\t\tlastRead: message.createdAt,\r\n\t\t\t\t\t\t\t// \t\t})\r\n\t\t\t\t\t\t\t// \t\t.then(() => {\r\n\t\t\t\t\t\t\t// \t\t\tdispatch(\r\n\t\t\t\t\t\t\t// \t\t\t\tsetUnread(\r\n\t\t\t\t\t\t\t// \t\t\t\t\troomName,\r\n\t\t\t\t\t\t\t// \t\t\t\t\tpersonID,\r\n\t\t\t\t\t\t\t// \t\t\t\t\tmessage.createdAt,\r\n\t\t\t\t\t\t\t// \t\t\t\t\tpersonSnapshot.val()[personID].unread + 1,\r\n\t\t\t\t\t\t\t// \t\t\t\t),\r\n\t\t\t\t\t\t\t// \t\t\t)\r\n\t\t\t\t\t\t\t// \t\t})\r\n\t\t\t\t\t\t\t// }\r\n\t\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t}\r\n}\r\n\r\nconst isAlreadyAdded = (data: any, id: string) => {\r\n\tfor (var key in data) {\r\n\t\tif (data[key].id === id) return true\r\n\t}\r\n\treturn false\r\n}\r\n\r\nexport const showError = (message: string) => ({\r\n\t\ttype: 'ERROR_MESSAGE',\r\n\t\tmessage\r\n})\r\n\r\nexport const sendMessage = (message: any, roomName: string) => ({\r\n\ttype: 'SEND_MESSAGE',\r\n\tmessage,\r\n\troomName,\r\n})\r\n\r\nexport const updateMessages = (messages: any, roomId: string) => ({\r\n\ttype: 'UPDATE_MESSAGES',\r\n\tmessages,\r\n\troomId,\r\n})\r\n\r\nexport const trySendMessage = (\r\n\ttext: string,\r\n\troomId: string,\r\n\tstatus: boolean = false,\r\n) => {\r\n\treturn (dispatch: any, getState: any) => {\r\n\t\tconst user = getState().auth\r\n\t\tif (user) {\r\n\t\t\tconst uid = user.uid\r\n\t\t\tconst displayName = user.displayName\r\n\t\t\tconst message = {\r\n\t\t\t\tsender: { uid, displayName },\r\n\t\t\t\ttext,\r\n\t\t\t\tcreatedAt: moment().format(),\r\n\t\t\t\tstatus,\r\n\t\t\t}\r\n\t\t\treturn database.collection(`rooms/${roomId}/messages`).add(message)\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport const orderRoomsStartState = () => ({\r\n\ttype: 'ORDER_ROOMS_START_STATE',\r\n})\r\n\r\nexport const availableRooms = (rooms: RoomItem[]) => ({\r\n\ttype: 'AVAILABLE_ROOMS',\r\n\trooms\r\n})\r\n\r\nexport const initSlacker = () => ({\r\n\ttype: 'INIT_SLACKER_SAGA'\r\n})\r\n\r\nexport const clearState = {\r\n\ttype: 'CLEAR_STATE',\r\n}\r\n\r\nexport const leaveRoom = (roomName: string, userId: string) => ({\r\n\ttype: 'LEAVE_ROOM',\r\n\troomName,\r\n\tuserId,\r\n})\r\n\r\n// export const startLeaveRoom = (roomName: string) => {\r\n// \treturn (dispatch: any, getState: any) => {\r\n// \t\tconst user = getState().auth\r\n// \t\tif (user) {\r\n// \t\t\tconst userId = user.uid\r\n// \t\t\tconst displayName = user.displayName\r\n// \t\t\tdatabase.ref(`rooms/${roomName}/people/${userId}`).remove()\r\n// \t\t\tdatabase.ref(`users/${userId}/rooms/${roomName}`).remove(() => {\r\n// \t\t\t\tdispatch(leaveRoom(roomName, userId))\r\n// \t\t\t\tdispatch(startSendMessage(`${displayName} left`, roomName, true))\r\n// \t\t\t\t// history.push(\"/join\");\r\n// \t\t\t})\r\n// \t\t}\r\n// \t}\r\n// }\r\n\r\nexport const clearUnread = (\r\n\troomName: string,\r\n\tuid: string,\r\n\ttime: any,\r\n\tunread: number,\r\n) => ({\r\n\ttype: 'CLEAR_UNREAD',\r\n\troomName,\r\n\tuid,\r\n\ttime,\r\n\tunread,\r\n})\r\n\r\nexport const setUnread = (\r\n\troomName: string,\r\n\tuid: string,\r\n\ttime: any,\r\n\tunread: number,\r\n) => {\r\n\treturn (dispatch: any) => {\r\n\t\tdispatch(clearUnread(roomName, uid, time, unread))\r\n\t}\r\n}\r\n\r\n// export const startClearUnread = (roomName: string) => {\r\n// \treturn (dispatch: any, getState: any) => {\r\n// \t\t// let time = moment().endOf(\"month\");\r\n// \t\tconst uid = getState().auth.uid\r\n// \t\tif (uid) {\r\n// \t\t\tconst time = moment().format()\r\n// \t\t\treturn database\r\n// \t\t\t\t.ref(`rooms/${roomName}/people/${uid}`)\r\n// \t\t\t\t.update({\r\n// \t\t\t\t\tunread: 0,\r\n// \t\t\t\t\tlastRead: time,\r\n// \t\t\t\t})\r\n// \t\t\t\t.then(() => {\r\n// \t\t\t\t\tdispatch(clearUnread(roomName, uid, time, 0))\r\n// \t\t\t\t})\r\n// \t\t}\r\n// \t}\r\n// }\r\n\r\nexport const onLeft = (roomName: string, personID: string) => ({\r\n\ttype: 'ON_LEFT',\r\n\troomName,\r\n\tpersonID,\r\n})\r\n\r\nexport const onJoined = (roomName: string, person: any) => ({\r\n\ttype: 'ON_JOINED',\r\n\troomName,\r\n\tperson,\r\n})\r\n\r\n\r\nexport const syncMessages = (messagesSnapshot: any, roomId: string) => {\r\n\tconst messages: any[] = []\r\n\tmessagesSnapshot.forEach((doc: any) => {\r\n\t\tmessages.push({ id: doc.id, ...doc.data() })\r\n\t})\r\n\r\n\tmessages.sort(byCreatedAt)\r\n\treturn updateMessages(messages, roomId)\r\n}\r\n","import React, { Fragment, Component } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport styled from 'styled-components'\r\nimport { Layout, Typography } from 'antd'\r\n\r\nimport LoadingSpinner from './LoadingSpinner'\r\nimport Message from './Message'\r\nimport { trySendMessage } from '../actions/rooms'\r\n\r\nconst { Header, Content } = Layout\r\nconst { Title } = Typography\r\n\r\nconst ChatWrapper = styled.div`\r\n\theight: 100%;\r\n\tpadding: 24;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tbackground: '#fff';\r\n`\r\n\r\nconst Messages = styled.div`\r\n\tpadding-top: 8px;\r\n\tpadding-bottom: 8px;\r\n\tflex-grow: 1;\r\n\toverflow-y: scroll;\r\n\toverflow-x: hidden;\r\n`\r\n\r\nconst InputForm = styled.form`\r\n\theight: 44px;\r\n\tbackground-color: #fff;\r\n\tborder-radius: 4px;\r\n\tborder: 1px solid #acacac;\r\n\tdisplay: flex;\r\n\tflex-direction: row;\r\n\tflex-shrink: 0;\r\n`\r\n\r\nconst Input = styled.input`\r\n\tpadding-left: 14px;\r\n\tborder: none;\r\n\tborder-radius: 4px;\r\n\tflex-grow: 1;\r\n\toutline: none;\r\n`\r\n\r\nconst SendButton = styled.button`\r\n\tflex-shrink: 0;\r\n\tpadding: 0px 15px;\r\n\tbackground: none;\r\n\tborder: none;\r\n`\r\n\r\ninterface Props {\r\n\tauth: Auth\r\n\troom: RoomItem | { id: null; name: string; messages: any[] }\r\n\tmatch: any\r\n\tisLoading: boolean\r\n\tmessages: Message[]\r\n\ttrySendMessage: (text: string, roomId: string, status?: boolean) => void\r\n}\r\n\r\nclass RoomContainer extends Component<Props> {\r\n\tstate = {\r\n\t\tmessageValue: '',\r\n\t}\r\n\r\n\tmessagesEnd: any = null\r\n\tmessagesContainer: HTMLElement | null = null\r\n\r\n\tcomponentWillMount() {\r\n\t\tconst { roomId } = this.props.match.params\r\n\t\tconsole.log(roomId)\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.scrollToBottom()\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps: Props) {\r\n\t\tif (prevProps.messages.length === 0 && this.props.messages.length > 0) {\r\n\t\t\tthis.scrollToBottom()\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t// scroll management\r\n\t\tif (\r\n\t\t\tprevProps.messages.length !== this.props.messages.length &&\r\n\t\t\tprevProps.messages.length > 0 &&\r\n\t\t\tthis.props.messages.length > 0\r\n\t\t) {\r\n\t\t\tconst previousLastMessage = prevProps.messages.slice(-1)[0]\r\n\t\t\tconst currentLastMessage = this.props.messages.slice(-1)[0]\r\n\t\t\tif (\r\n\t\t\t\tpreviousLastMessage.id !== currentLastMessage.id &&\r\n\t\t\t\t!!currentLastMessage &&\r\n\t\t\t\tcurrentLastMessage.sender.uid === this.props.auth.uid\r\n\t\t\t) {\r\n\t\t\t\t// last message was ours, scroll to the bottom\r\n\t\t\t\tthis.scrollToBottom()\r\n\t\t\t} else if (this.messagesContainer) {\r\n\t\t\t\t// last message is not ours, lets check scroll\r\n\t\t\t\tconst {\r\n\t\t\t\t\tscrollHeight,\r\n\t\t\t\t\tscrollTop,\r\n\t\t\t\t\toffsetHeight,\r\n\t\t\t\t\tclientHeight,\r\n\t\t\t\t} = this.messagesContainer\r\n\t\t\t\tconst calculato = scrollHeight - scrollTop === clientHeight\r\n\r\n\t\t\t\t// if our scroll is around bottom 2 messages, scroll to bottom pls\r\n\t\t\t\tif (Math.abs(clientHeight - (scrollHeight - scrollTop - 45)) < 45) {\r\n\t\t\t\t\tthis.scrollToBottom()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\thandleTyping = (e: any) => {\r\n\t\tthis.setState({ messageValue: e.target.value })\r\n\t}\r\n\r\n\tscrollToBottom = () => {\r\n\t\tif (this.messagesEnd) {\r\n\t\t\tthis.messagesEnd.scrollIntoView({ behavior: 'auto' })\r\n\t\t}\r\n\t}\r\n\r\n\thandleSend = (e: any) => {\r\n\t\te.preventDefault()\r\n\t\tconst { room } = this.props\r\n\t\tconst text = this.state.messageValue\r\n\t\tif (!!room.id && text.length > 0) {\r\n\t\t\tthis.props.trySendMessage(text, room.id)\r\n\t\t\tthis.setState({\r\n\t\t\t\tmessageValue: '',\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { room, messages, isLoading } = this.props\r\n\t\t// console.log(messages)\r\n\t\tlet content = <LoadingSpinner />\r\n\t\tif (!isLoading) {\r\n\t\t\tcontent = (\r\n\t\t\t\t<ChatWrapper>\r\n\t\t\t\t\t<Messages\r\n\t\t\t\t\t\tref={el => {\r\n\t\t\t\t\t\t\tthis.messagesContainer = el\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{messages.map((message, idx) => (\r\n\t\t\t\t\t\t\t<Message\r\n\t\t\t\t\t\t\t\tisConsecutive={\r\n\t\t\t\t\t\t\t\t\t!!messages[idx - 1] &&\r\n\t\t\t\t\t\t\t\t\tmessages[idx - 1].sender.uid === message.sender.uid\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tname={message.sender.displayName || ''}\r\n\t\t\t\t\t\t\t\tkey={message.id}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{message.text}\r\n\t\t\t\t\t\t\t</Message>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tstyle={{ float: 'left', clear: 'both' }}\r\n\t\t\t\t\t\t\tref={el => {\r\n\t\t\t\t\t\t\t\tthis.messagesEnd = el\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</Messages>\r\n\t\t\t\t\t<InputForm onSubmit={this.handleSend}>\r\n\t\t\t\t\t\t<Input\r\n\t\t\t\t\t\t\tvalue={this.state.messageValue}\r\n\t\t\t\t\t\t\tonChange={this.handleTyping}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<SendButton type={'submit'}>Send</SendButton>\r\n\t\t\t\t\t</InputForm>\r\n\t\t\t\t</ChatWrapper>\r\n\t\t\t)\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<Fragment>\r\n\t\t\t\t<Header\r\n\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\tbackground: '#fff',\r\n\t\t\t\t\t\tborderBottom: '1px solid #acacac',\r\n\t\t\t\t\t\tpadding: 16,\r\n\t\t\t\t\t\tdisplay: 'flex',\r\n\t\t\t\t\t\tflexDirection: 'row',\r\n\t\t\t\t\t\talignItems: 'center',\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Title style={{ margin: 0 }} level={3}>\r\n\t\t\t\t\t\t# {room.name}\r\n\t\t\t\t\t</Title>\r\n\t\t\t\t</Header>\r\n\t\t\t\t<Content\r\n\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\tmargin: '0px 16px 24px 26px',\r\n\t\t\t\t\t\toverflow: 'initial',\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t{content}\r\n\t\t\t\t</Content>\r\n\t\t\t</Fragment>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nconst mapStateToProps = (state: StoreState, ownProps: any) => {\r\n\tconst { roomId } = ownProps.match.params\r\n\tconst room = state.rooms.joined.find(room => room.id === roomId)\r\n\tconst messages = room ? room.messages : []\r\n\treturn {\r\n\t\tauth: state.auth,\r\n\t\troom: room || { id: null, name: '', messages: [] },\r\n\t\tmessages,\r\n\t\tisLoading: !room,\r\n\t}\r\n}\r\n\r\nexport default connect(\r\n\tmapStateToProps,\r\n\t{ trySendMessage },\r\n)(RoomContainer)\r\n","import React, { Component } from 'react'\r\nimport styled from 'styled-components'\r\nimport { connect } from 'react-redux'\r\nimport { Modal, Input, Typography } from 'antd'\r\nimport { tryCreateRoom, RoomData } from '../actions/rooms'\r\n\r\nconst { TextArea } = Input\r\nconst { Text } = Typography\r\n\r\nconst TextWrap = styled.div`\r\n\tmargin-top: 5px;\r\n\tmargin-bottom: 5px;\r\n`\r\n\r\ninterface Props {\r\n\tisOpen: boolean;\r\n\thandleClose: () => void;\r\n\ttryCreateRoom: (roomData: RoomData, showCreateError?: any) => Promise<any>;\r\n\tauth: Auth;\r\n}\r\n\r\ninterface State {\r\n\troomName: string;\r\n\tdescription: string;\r\n}\r\n\r\nclass CreateChatDialog extends Component<Props, State> {\r\n\tstate = {\r\n\t\troomName: '',\r\n\t\tdescription: '',\r\n\t}\r\n\r\n\thandleChange = (e: any) => {\r\n\t\tconsole.log(e.target.name)\r\n\t\t// @ts-ignore\r\n\t\tthis.setState({\r\n\t\t\t[e.target.name]: e.target.value,\r\n\t\t})\r\n\t}\r\n\r\n\thandleSubmit = () => {\r\n\t\tconst { uid, displayName: userDisplayName } = this.props.auth\r\n\t\tif (uid) {\r\n\t\t\tconsole.log('Create this room pls')\r\n\t\t\tconst roomName = this.state.roomName\r\n\t\t\tif (roomName && roomName.length > 0) {\r\n\t\t\t\t// this.setState({ error: '' })\r\n\t\t\t\tconst room = {\r\n\t\t\t\t\tname: roomName,\r\n\t\t\t\t\tpeople: {\r\n\t\t\t\t\t\tid: uid,\r\n\t\t\t\t\t\tname: userDisplayName,\r\n\t\t\t\t\t\tunread: 0,\r\n\t\t\t\t\t\tlastRead: 0,\r\n\t\t\t\t\t},\r\n\t\t\t\t}\r\n\t\t\t\tthis.props.tryCreateRoom(room)\r\n\t\t\t\tthis.props.handleClose()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Modal\r\n\t\t\t\ttitle=\"Create Room\"\r\n\t\t\t\tvisible={this.props.isOpen}\r\n\t\t\t\tonOk={this.handleSubmit}\r\n\t\t\t\tonCancel={this.props.handleClose}\r\n\t\t\t\tokButtonProps={{ disabled: !this.props.auth.uid }}\r\n\t\t\t\tcancelButtonProps={{ disabled: !this.props.auth.uid }}\r\n\t\t\t>\r\n\t\t\t\t<TextWrap>\r\n\t\t\t\t\t<Text>Name:</Text>\r\n\t\t\t\t</TextWrap>\r\n\t\t\t\t<Input\r\n\t\t\t\t\tname=\"roomName\"\r\n\t\t\t\t\tvalue={this.state.roomName}\r\n\t\t\t\t\tonChange={this.handleChange}\r\n\t\t\t\t/>\r\n\t\t\t\t<TextWrap>\r\n\t\t\t\t\t<Text>Description:</Text>\r\n\t\t\t\t</TextWrap>\r\n\t\t\t\t<TextArea\r\n\t\t\t\t\tname=\"description\"\r\n\t\t\t\t\tvalue={this.state.description}\r\n\t\t\t\t\tonChange={this.handleChange}\r\n\t\t\t\t\trows={4}\r\n\t\t\t\t/>\r\n\t\t\t</Modal>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nconst mapStateToProps = (state: any) => ({\r\n\tauth: state.auth,\r\n})\r\n\r\nexport default connect(\r\n\tmapStateToProps,\r\n\t{ tryCreateRoom },\r\n)(CreateChatDialog)\r\n","import React, { Component } from 'react'\r\nimport { BrowserRouter as Router, Route, Switch } from 'react-router-dom'\r\nimport styled from 'styled-components'\r\nimport { connect } from 'react-redux'\r\nimport { Layout, Menu, Button, Icon } from 'antd'\r\nimport RoomContainer from './RoomContainer'\r\nimport CreateChatDialog from './CreateChatDialog'\r\nimport LoadingSpinner from './LoadingSpinner'\r\nimport { tryLogin } from '../actions/auth'\r\nimport { initSlacker } from '../actions/rooms'\r\nimport '../styles/index.css'\r\n\r\nconst { Sider } = Layout\r\n// const { Text } = Typography\r\n\r\nconst ButtonWrap = styled.div`\r\n\ttext-align: center;\r\n\tpadding: 15px;\r\n`\r\n\r\nconst RoomButtons = styled.div`\r\n\tpadding: 10px;\r\n\tcolor: rgba(255, 255, 255, 0.65);\r\n\tdisplay: flex;\r\n\tjustify-content: space-between;\r\n\talign-items: center;\r\n\tbackground: none;\r\n\tborder: none;\r\n\t-webkit-transition: color .5s;\r\n\ttransition: color .5s;\r\n\tcursor: pointer;\r\n\t&:hover {\r\n\t\tcolor: #fff;\r\n\t}\r\n`\r\n\r\ninterface Props {\r\n\ttryLogin: () => void\r\n\tinitSlacker: () => void\r\n\tauth: Auth\r\n\trooms: {\r\n\t\tjoined: RoomItem[]\r\n\t\tavailable: RoomItem[]\r\n\t}\r\n\thistory: any\r\n\tlocation: {\r\n\t\tpathname: any\r\n\t}\r\n}\r\n\r\ninterface State {\r\n\tisCreateRoomDialogOpen: boolean\r\n}\r\n\r\nclass App extends Component<Props> {\r\n\tstate = {\r\n\t\tisCreateRoomDialogOpen: false,\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.props.tryLogin()\r\n\t}\r\n\r\n\tcomponentWillUpdate(nextProps: Props) {\r\n\t\tif (!this.props.auth.uid && nextProps.auth.uid) {\r\n\t\t\tthis.props.initSlacker()\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps: Props) {\r\n\t\tconst { location, rooms, history } = this.props\r\n\t\tif (\r\n\t\t\tlocation.pathname === '/' &&\r\n\t\t\tprevProps.rooms.joined.length === 0 &&\r\n\t\t\trooms.joined.length !== 0\r\n\t\t) {\r\n\t\t\tconsole.log('redirect to first room?')\r\n\t\t\thistory.push(`/r/${rooms.joined[0].id}`)\r\n\t\t}\r\n\t}\r\n\r\n\thandleCloseCreateChatDialog = () => {\r\n\t\tthis.setState({\r\n\t\t\tisCreateRoomDialogOpen: false,\r\n\t\t})\r\n\t}\r\n\r\n\thandleOpenCreateChatDialog = () => {\r\n\t\tthis.setState({\r\n\t\t\tisCreateRoomDialogOpen: true,\r\n\t\t})\r\n\t}\r\n\r\n\thandleRoomSelect = ({ key }: { key: string }) => {\r\n\t\tthis.props.history.push(key)\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Layout style={{ height: '100%' }}>\r\n\t\t\t\t<Sider\r\n\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\toverflow: 'auto',\r\n\t\t\t\t\t\theight: '100vh',\r\n\t\t\t\t\t\tposition: 'fixed',\r\n\t\t\t\t\t\tleft: 0,\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<ButtonWrap>\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\ticon=\"plus\"\r\n\t\t\t\t\t\t\ttype=\"primary\"\r\n\t\t\t\t\t\t\tonClick={this.handleOpenCreateChatDialog}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tCreate room\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t</ButtonWrap>\r\n\t\t\t\t\t<CreateChatDialog\r\n\t\t\t\t\t\tisOpen={this.state.isCreateRoomDialogOpen}\r\n\t\t\t\t\t\thandleClose={this.handleCloseCreateChatDialog}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<RoomButtons>\r\n\t\t\t\t\t\t<span>Rooms:</span>\r\n\t\t\t\t\t\t<Icon type=\"plus-circle\" />\r\n\t\t\t\t\t</RoomButtons>\r\n\t\t\t\t\t<Menu\r\n\t\t\t\t\t\ttheme=\"dark\"\r\n\t\t\t\t\t\tmode=\"inline\"\r\n\t\t\t\t\t\tonSelect={this.handleRoomSelect}\r\n\t\t\t\t\t\tdefaultSelectedKeys={[this.props.location.pathname]}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{this.props.rooms.joined.map(room => (\r\n\t\t\t\t\t\t\t<Menu.Item key={`/r/${room.id}`}>\r\n\t\t\t\t\t\t\t\t<span className=\"nav-text\"># {room.name}</span>\r\n\t\t\t\t\t\t\t</Menu.Item>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</Menu>\r\n\t\t\t\t</Sider>\r\n\t\t\t\t<Layout style={{ marginLeft: 200, background: '#fff' }}>\r\n\t\t\t\t\t<Switch>\r\n\t\t\t\t\t\t<Route path={'/r/:roomId'} component={RoomContainer} />\r\n\t\t\t\t\t\t<Route path={'/'}>\r\n\t\t\t\t\t\t\t{this.props.rooms.joined.length === 0 ? (\r\n\t\t\t\t\t\t\t\t<LoadingSpinner />\r\n\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t<div>No chat selected</div>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t</Switch>\r\n\t\t\t\t</Layout>\r\n\t\t\t</Layout>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nconst mapStateToProps = (state: StoreState) => ({\r\n\tauth: state.auth,\r\n\trooms: state.rooms,\r\n})\r\n\r\nexport default connect(\r\n\tmapStateToProps,\r\n\t{ tryLogin, initSlacker },\r\n)(App)\r\n","import { firebase } from \"../firebase/firebase\";\r\n\r\nexport const loginSuccess = (uid: string, displayName: string) => ({\r\n  type: \"LOGIN\",\r\n  uid,\r\n  displayName\r\n});\r\n\r\nexport const tryLogin = () => {\r\n  return (dispatch: any) => {\r\n    return firebase\r\n      .auth()\r\n      .signInAnonymously()\r\n      .then(response => {\r\n        // console.log(response);\r\n        const { user } = response;\r\n\r\n        if (user) {\r\n          const displayName = user.displayName || \"Ninja\";\r\n          return dispatch(loginSuccess(user.uid, displayName));\r\n        }\r\n      })\r\n      .catch(function(error) {\r\n        console.log({ error });\r\n        // Handle Errors here.\r\n        var errorCode = error.code;\r\n        var errorMessage = error.message;\r\n        // ...\r\n      });\r\n  };\r\n};\r\n\r\nexport const logout = () => ({\r\n  type: \"LOGOUT\"\r\n});\r\n\r\nexport const tryLogout = () => {\r\n  return () => {\r\n    return firebase\r\n      .auth()\r\n      .signOut()\r\n      .then(() => {\r\n        console.log(\"log out!!!\");\r\n      });\r\n  };\r\n};\r\n","import moment from 'moment'\r\n\r\ninterface RoomsState {\r\n\tjoined: Room[];\r\n\tavailable: Room[];\r\n}\r\n\r\nconst defaultState: RoomsState = {\r\n\tjoined: [],\r\n\tavailable: [],\r\n}\r\n\r\nexport default (state: RoomsState = defaultState, action: any) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'CREATE_ROOM':\r\n\t\t\treturn { ...state, joined: [...state.joined, action.room] }\r\n\t\tcase 'JOINED_ROOM':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tjoined: [...state.joined, action.room],\r\n\t\t\t}\r\n\r\n\t\tcase 'AVAILABLE_ROOMS':\r\n\t\t\treturn { ...state, available: action.rooms }\r\n\r\n\t\t// case 'ON_LEFT':\r\n\t\t// \t// console.log('onleft');\r\n\r\n\t\t// \treturn state.map(room => {\r\n\t\t// \t\t// console.log(room);\r\n\t\t// \t\tif (room.name === action.roomName) {\r\n\t\t// \t\t\tconst p = room.people.filter((person: Person) => {\r\n\t\t// \t\t\t\treturn person.id !== action.personID\r\n\t\t// \t\t\t})\r\n\t\t// \t\t\t// console.log(p);\r\n\t\t// \t\t\treturn {\r\n\t\t// \t\t\t\t...room,\r\n\t\t// \t\t\t\tpeople: p,\r\n\t\t// \t\t\t}\r\n\t\t// \t\t} else {\r\n\t\t// \t\t\treturn room\r\n\t\t// \t\t}\r\n\t\t// \t})\r\n\r\n\t\t// case 'ON_JOINED':\r\n\t\t// \treturn state.map(room => {\r\n\t\t// \t\tif (room.name === action.roomName) {\r\n\t\t// \t\t\troom.people.push(action.person)\r\n\t\t// \t\t\treturn room\r\n\t\t// \t\t} else {\r\n\t\t// \t\t\treturn room\r\n\t\t// \t\t}\r\n\t\t// \t})\r\n\r\n\t\tcase 'SEND_MESSAGE':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tjoined: state.joined.map(room => {\r\n\t\t\t\t\tif (room.name === action.roomName) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t...room,\r\n\t\t\t\t\t\t\tmessages: [...room.messages, action.message],\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn room\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t}\r\n\t\tcase 'UPDATE_MESSAGES':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tjoined: state.joined.map(room => {\r\n\t\t\t\t\tif (room.id === action.roomId) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t...room,\r\n\t\t\t\t\t\t\tmessages: [...action.messages],\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn room\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t}\r\n\t\t// case 'REORDER_ROOMS':\r\n\t\t//   let room;\r\n\t\t//   let rooms = state.filter((r) => {\r\n\t\t//     if(r.name === action.roomName) {\r\n\t\t//       room = r;\r\n\t\t//       return false;\r\n\t\t//     }\r\n\t\t//     else {\r\n\t\t//       return true;\r\n\t\t//     }\r\n\t\t//   });\r\n\t\t//   rooms.unshift(room);\r\n\t\t//   return rooms;\r\n\t\t// case 'ORDER_ROOMS_START_STATE':\r\n\t\t// \t//  const x =  action.rooms.sort((a, b) => {\r\n\t\t// \t//   //  console.log('a', a);\r\n\t\t// \t//   //  console.log('b', b);\r\n\t\t// \t//   if(a.messages.length > 0 && b.messages.length > 0) {\r\n\t\t// \t//     console.log(typeof a.messages);\r\n\r\n\t\t// \t//     return moment(a.messages[a.messages.length-1].createdAt) > moment(b.messages[b.messages.length-1].createdAt)\r\n\t\t// \t//     // {\r\n\t\t// \t//   //     return -1;\r\n\t\t// \t//   //   } else {\r\n\t\t// \t//   //     return 1;\r\n\t\t// \t//   //   }\r\n\t\t// \t//   // }\r\n\t\t// \t//   // else {\r\n\t\t// \t//   //   return -1;\r\n\t\t// \t//   }\r\n\t\t// \t// });\r\n\t\t// \t// console.log(typeof x)\r\n\t\t// \t// console.log(x);\r\n\t\t// \t// return x;\r\n\t\t// \tstate.sort((a: any, b: any) => {\r\n\t\t// \t\treturn moment(a.messages[a.messages.length - 1].createdAt) <\r\n\t\t// \t\t\tmoment(b.messages[b.messages.length - 1].createdAt)\r\n\t\t// \t\t\t? 1\r\n\t\t// \t\t\t: -1\r\n\t\t// \t})\r\n\t\t// \t// console.log(state);\r\n\t\t// \treturn state.map(room => room)\r\n\r\n\t\t// case 'CLEAR_UNREAD':\r\n\t\t// \treturn state.map(room => {\r\n\t\t// \t\tif (room.name === action.roomName) {\r\n\t\t// \t\t\tconst people = room.people.map((person: Person) => {\r\n\t\t// \t\t\t\tif (person.id === action.uid) {\r\n\t\t// \t\t\t\t\treturn {\r\n\t\t// \t\t\t\t\t\t...person,\r\n\t\t// \t\t\t\t\t\tunread: action.unread,\r\n\t\t// \t\t\t\t\t\tlastRead: action.time,\r\n\t\t// \t\t\t\t\t}\r\n\t\t// \t\t\t\t} else {\r\n\t\t// \t\t\t\t\treturn person\r\n\t\t// \t\t\t\t}\r\n\t\t// \t\t\t})\r\n\t\t// \t\t\treturn { ...room, people }\r\n\t\t// \t\t} else {\r\n\t\t// \t\t\treturn room\r\n\t\t// \t\t}\r\n\t\t// \t})\r\n\r\n\t\t// case 'LEAVE_ROOM':\r\n\t\t// \treturn state.filter(room => {\r\n\t\t// \t\treturn room.name !== action.roomName\r\n\t\t// \t})\r\n\t\t// case 'CLEAR_STATE':\r\n\t\t// \treturn []\r\n\t\tdefault:\r\n\t\t\treturn state\r\n\t}\r\n}\r\n","import authReducer from '../reducers/auth'\r\nimport roomsReducer from '../reducers/rooms'\r\nimport redirectReducer from '../reducers/redirect'\r\nimport { combineReducers } from 'redux'\r\n\r\nconst reducers = combineReducers({\r\n\tauth: authReducer,\r\n\trooms: roomsReducer,\r\n\tredirect: redirectReducer,\r\n})\r\n\r\nexport default reducers\r\n","export default (state = {}, action: any) => {\r\n  switch (action.type) {\r\n    case \"LOGIN\":\r\n      return {\r\n        uid: action.uid,\r\n        displayName: action.displayName\r\n      };\r\n    case \"LOGOUT\":\r\n      return {};\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n","export default (state = {}, action: any) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'REDIRECT_TO':\r\n\t\t\treturn {\r\n\t\t\t\tredirectTo: action.redirectTo,\r\n\t\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state\r\n\t}\r\n}\r\n","import { put, select, takeLatest, fork, call } from 'redux-saga/effects'\r\nimport database, { firebase, rsf } from '../firebase/firebase'\r\nimport { availableRooms, createRoom, syncMessages } from '../actions/rooms'\r\n\r\nconst byCreatedAt = function(a: any, b: any) {\r\n\t// @ts-ignore\r\n\treturn new Date(a.createdAt) - new Date(b.createdAt)\r\n}\r\n\r\nexport function* fetchRoomSaga(roomId: string) {\r\n\tconsole.log('try fetch room ', roomId)\r\n\t// fetch joined room from firestore\r\n\tconst roomRef = database.collection('rooms').doc(roomId)\r\n\tconst roomDoc = yield call(rsf.firestore.getDocument, roomRef)\r\n\r\n\t// if we have such room\r\n\tif (roomDoc.exists) {\r\n\t\tconst room = roomDoc.data()\r\n\t\tconst people: any[] = []\r\n\t\tconst messages: any[] = []\r\n\r\n\t\t// get room's people\r\n\t\tconst peopleQuery = yield call(\r\n\t\t\trsf.firestore.getCollection,\r\n\t\t\troomRef.collection('people'),\r\n\t\t)\r\n\t\tpeopleQuery.forEach((peopleDoc: any) => {\r\n\t\t\tpeople.push({ id: peopleDoc.id, ...peopleDoc.data() })\r\n\t\t})\r\n\t\tconsole.log({ people })\r\n\r\n\t\t// get room's people\r\n\t\tconst messagesQuery = yield call(\r\n\t\t\trsf.firestore.getCollection,\r\n\t\t\troomRef.collection('messages'),\r\n\t\t)\r\n\t\tmessagesQuery.forEach((messageDoc: any) => {\r\n\t\t\tmessages.push({\r\n\t\t\t\tid: messageDoc.id,\r\n\t\t\t\t...messageDoc.data(),\r\n\t\t\t})\r\n\t\t})\r\n\t\tmessages.sort(byCreatedAt)\r\n\t\tconsole.log({ messages })\r\n\r\n\t\tyield put(\r\n\t\t\tcreateRoom({\r\n\t\t\t\tid: roomRef.id,\r\n\t\t\t\tname: room ? room.name : 'Error',\r\n\t\t\t\tpeople,\r\n\t\t\t\tmessages,\r\n\t\t\t}),\r\n\t\t)\r\n\r\n\t\t// subscribe to messages\r\n\t\tyield fork(rsf.firestore.syncCollection, roomRef.collection('messages'), {\r\n\t\t\tsuccessActionCreator: (snapshot: any) => syncMessages(snapshot, roomId),\r\n\t\t})\r\n\t}\r\n}\r\n\r\n// worker Saga: will be fired on USER_FETCH_REQUESTED actions\r\nfunction* initSlackerSaga(action: any) {\r\n\tconst auth = yield select(state => state.auth)\r\n\r\n\tif (!auth.uid) {\r\n\t\tconsole.log('no auth!')\r\n\t\treturn\r\n\t}\r\n\r\n\t// fetch all rooms\r\n\tconst roomsPromise = database.collection('rooms').get()\r\n\r\n\tconst roomsQuery: firebase.firestore.QuerySnapshot = yield roomsPromise\r\n\tconst rooms: RoomItem[] = []\r\n\troomsQuery.forEach(doc => {\r\n\t\tconst room = {\r\n\t\t\tid: doc.id,\r\n\t\t\t...doc.data(),\r\n\t\t}\r\n\t\t// @ts-ignore\r\n\t\trooms.push(room)\r\n\t})\r\n\r\n\tyield put(availableRooms(rooms))\r\n\tconst generalRoom = rooms.find(room => room.name === 'general')\r\n\r\n\t// get user rooms\r\n\tconst userRoomsQuery = yield call(\r\n\t\trsf.firestore.getCollection,\r\n\t\t`users/${auth.uid}/rooms`,\r\n\t)\r\n\r\n\tif (!userRoomsQuery.empty) {\r\n\t\tconst userRoomIds: string[] = []\r\n\t\tuserRoomsQuery.forEach((userRoomDoc: any) =>\r\n\t\t\tuserRoomIds.push(userRoomDoc.id),\r\n\t\t)\r\n\r\n\t\t// fetch each joined room\r\n\t\tfor (let roomId of userRoomIds) {\r\n\t\t\tconst task = yield fork(fetchRoomSaga, roomId)\r\n\t\t}\r\n\r\n\t\t// if no general room, join that as well\r\n\t\tif(generalRoom && !userRoomIds.includes(generalRoom.id)) {\r\n\t\t\tyield put({\r\n\t\t\t\ttype: 'JOIN_ROOM_SAGA',\r\n\t\t\t\troomId: generalRoom.id,\r\n\t\t\t\troom: generalRoom,\r\n\t\t\t})\r\n\t\t}\r\n\t} else {\r\n\t\tif (generalRoom) {\r\n\t\t\tyield put({\r\n\t\t\t\ttype: 'JOIN_ROOM_SAGA',\r\n\t\t\t\troomId: generalRoom.id,\r\n\t\t\t\troom: generalRoom,\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction* mySaga() {\r\n\tyield takeLatest('INIT_SLACKER_SAGA', initSlackerSaga)\r\n}\r\n\r\nexport default mySaga\r\n","import { put, select, takeEvery, fork, call } from 'redux-saga/effects'\r\nimport { AnyAction } from 'redux'\r\nimport database, { firebase, rsf } from '../firebase/firebase'\r\nimport { joinedRoom, showError, syncMessages } from '../actions/rooms'\r\nimport { fetchRoomSaga } from './initSaga'\r\n\r\nconst byCreatedAt = function(a: any, b: any) {\r\n\t// @ts-ignore\r\n\treturn new Date(a.createdAt) - new Date(b.createdAt)\r\n}\r\n\r\nfunction* joinRoom(action: AnyAction) {\r\n\tconst { roomId } = action\r\n\tconst { uid, displayName } = yield select(state => state.auth)\r\n\tconst roomRef = database.doc(`rooms/${roomId}`)\r\n\r\n\tconst roomDoc = yield call(rsf.firestore.getDocument, roomRef)\r\n\tconst room = <RoomItem>{ id: roomDoc.id, ...roomDoc.data() }\r\n\r\n\tif (!room || !roomDoc.exists) {\r\n\t\tyield put(showError('Room not found!'))\r\n\t\treturn\r\n\t} else if (\r\n\t\troom.people &&\r\n\t\troom.people.find((person: Person) => person.id === uid)\r\n\t) {\r\n\t\t// if we are already in this room then\r\n\t\t// history.push(`room/${data.roomName}`);\r\n\t\t// return i guess ?\r\n\t\treturn\r\n\t} else {\r\n\t\t// we should add ourselves to this room\r\n\r\n\t\tconst person = {\r\n\t\t\tname: displayName,\r\n\t\t\tid: uid,\r\n\t\t\tunread: 0,\r\n\t\t\tlastRead: 0,\r\n\t\t}\r\n\r\n\t\t// TODO figure wtf is wrong here\r\n\t\tyield call(\r\n\t\t\t// @ts-ignore\r\n\t\t\trsf.firestore.setDocument,\r\n\t\t\t`rooms/${roomId}/people/${person.id}`,\r\n\t\t\tperson,\r\n\t\t)\r\n\r\n\t\tyield call(\r\n\t\t\t// @ts-ignore\r\n\t\t\trsf.firestore.setDocument,\r\n\t\t\t`users/${person.id}/rooms/${roomId}`,\r\n\t\t\t{ roomName: room.name },\r\n\t\t)\r\n\r\n\t\t// fetch full room and subscribe\r\n\t\tyield call(fetchRoomSaga, roomId)\r\n\t}\r\n}\r\n\r\nfunction* joinRoomSaga() {\r\n\tyield takeEvery('JOIN_ROOM_SAGA', joinRoom)\r\n}\r\n\r\nexport default joinRoomSaga\r\n","import { all } from 'redux-saga/effects'\r\nimport initSaga from './initSaga'\r\nimport joinRoomSaga from './joinRoomSaga'\r\n\r\nexport default function* rootSaga() {\r\n\tyield all([initSaga(), joinRoomSaga()])\r\n}\r\n","import { createStore, combineReducers, applyMiddleware, compose } from 'redux'\r\nimport thunk from 'redux-thunk'\r\nimport createSagaMiddleware from 'redux-saga'\r\nimport reducers from '../reducers'\r\n\r\nimport mySaga from '../sagas/rootSaga'\r\n\r\n// create the saga middleware\r\nconst sagaMiddleware = createSagaMiddleware()\r\n\r\n// @ts-ignore\r\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose\r\n\r\nexport default () => {\r\n\tconst store = createStore(\r\n\t\treducers,\r\n\t\tcomposeEnhancers(applyMiddleware(thunk, sagaMiddleware)),\r\n\t)\r\n\r\n\tsagaMiddleware.run(mySaga)\r\n\r\n\treturn store\r\n}\r\n","import React from 'react'\r\nimport { Provider } from 'react-redux'\r\nimport { HashRouter as Router, Route } from 'react-router-dom'\r\nimport ReactDOM from 'react-dom'\r\nimport 'antd/dist/antd.css'\r\n\r\nimport App from './components/App'\r\nimport configureStore from './store/configureStore'\r\n\r\nconst store = configureStore()\r\nconst jsx = (\r\n\t<Provider store={store}>\r\n\t\t<Router>\r\n\t\t\t<Route path={'/'} component={App} />\r\n\t\t</Router>\r\n\t</Provider>\r\n)\r\n\r\nReactDOM.render(jsx, document.getElementById('container'))\r\n"],"sourceRoot":""}