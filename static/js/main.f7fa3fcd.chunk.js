(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{220:function(e,t,n){e.exports=n(395)},388:function(e,t,n){},395:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(29),i=n(158),c=n(76),s=n(6),l=n.n(s),u=(n(229),n(34)),d=n(35),p=n(37),m=n(36),f=n(38),h=n(19),b=n(20),g=n(401),O=n(13),v=n(406),j=n(203);function E(){var e=Object(h.a)(["\n\twidth: 100%;\n\tpadding: 24;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: '#fff';\n\tjustify-content: center;\n\talign-items: center;\n"]);return E=function(){return e},e}var y=b.a.div(E()),x=function(){return r.a.createElement(y,null,r.a.createElement(j.a,{size:"large"}))},k=n(398);function C(){var e=Object(h.a)(["\n\tcolor: black;\n\tfont-weight: bold;\n\tmargin-top: 2px;\n"]);return C=function(){return e},e}function w(){var e=Object(h.a)(["\n\tcolor: black;\n"]);return w=function(){return e},e}function R(){var e=Object(h.a)(["\n\twidth: 46px;\n\tpadding: 5px;\n"]);return R=function(){return e},e}function S(){var e=Object(h.a)(["\n\tdisplay: flex;\n\tflex-direction: row;\n\tmargin-bottom: 2px;\n"]);return S=function(){return e},e}var A=b.a.div(S()),I=b.a.div(R()),D=b.a.div(w()),T=b.a.div(C()),_=function(e){var t=e.children,n=e.name;return e.isConsecutive?r.a.createElement(A,null,r.a.createElement(I,null),r.a.createElement(D,null,t)):r.a.createElement(A,null,r.a.createElement(I,null,r.a.createElement(k.a,{size:35,shape:"square",icon:"user"})),r.a.createElement(D,null,r.a.createElement(T,null,n),t))},N=n(17),L=n(78),P=n.n(L),M=(n(196),n(207)),B=n.n(M),U=P.a.initializeApp({apiKey:"AIzaSyB2tCxT6yP0CWtCbD9JDj3ZKaxxW8T25PI",authDomain:"slacker-c3b01.firebaseapp.com",databaseURL:"https://slacker-c3b01.firebaseio.com",projectId:"slacker-c3b01",storageBucket:"slacker-c3b01.appspot.com",messagingSenderId:"286218247810"}),J=new B.a(U),G=P.a.firestore(),z=new P.a.auth.GithubAuthProvider,H=new P.a.auth.GoogleAuthProvider,K=P.a.auth(),W=n(208),V=n.n(W),q=function(e,t){return new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()},X=function(e){var t=e.id,n=e.name,a=e.people,r=e.messages;return{type:"CREATE_ROOM",room:{id:t,name:n,people:a,messages:void 0===r?[]:r}}},F=function(e){return{type:"ERROR_MESSAGE",message:e}},Y=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(a,r){var o=r().auth;if(o){var i={sender:{uid:o.uid,displayName:o.displayName},text:e,createdAt:V()().format(),status:n};return G.collection("rooms/".concat(t,"/messages")).add(i)}}},Z=function(e){return{type:"AVAILABLE_ROOMS",rooms:e}},Q=function(e,t){var n=[];return e.forEach(function(e){n.push(Object(N.a)({id:e.id},e.data()))}),n.sort(q),function(e,t){return{type:"UPDATE_MESSAGES",messages:e,roomId:t}}(n,t)};function $(){var e=Object(h.a)(["\n\tflex-shrink: 0;\n\tpadding: 0px 15px;\n\tbackground: none;\n\tborder: none;\n"]);return $=function(){return e},e}function ee(){var e=Object(h.a)(["\n\tpadding-left: 14px;\n\tborder: none;\n\tborder-radius: 4px;\n\tflex-grow: 1;\n\toutline: none;\n"]);return ee=function(){return e},e}function te(){var e=Object(h.a)(["\n\theight: 44px;\n\tbackground-color: #fff;\n\tborder-radius: 4px;\n\tborder: 1px solid #acacac;\n\tdisplay: flex;\n\tflex-direction: row;\n\tflex-shrink: 0;\n"]);return te=function(){return e},e}var ne=b.a.form(te()),ae=b.a.input(ee()),re=b.a.button($()),oe=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={value:""},n.handleTyping=function(e){n.setState({value:e.target.value})},n.handleSend=function(e){e.preventDefault();var t=n.props.room,a=n.state.value;t&&t.id&&a.length>0&&(n.props.trySendMessage(a,t.id),n.setState({value:""}))},n}return Object(f.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement(ne,{onSubmit:this.handleSend},r.a.createElement(ae,{value:this.state.value,onChange:this.handleTyping}),r.a.createElement(re,{type:"submit"},"Send"))}}]),t}(a.Component),ie=Object(o.b)(null,{trySendMessage:Y})(oe),ce=n(403),se=n(59),le=n(405),ue=n(404),de=n(399),pe=n(400),me=function(){return function(e){return K.signInAnonymously().then(function(e){e.user}).catch(function(e){console.log({error:e});e.code,e.message})}};function fe(){var e=Object(h.a)(["\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: center;\n\talign-items: center;\n"]);return fe=function(){return e},e}le.a.TextArea,ce.a.Text;var he=ce.a.Title,be=b.a.div(fe()),ge=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).handleTryLogin=function(e){n.props.tryLoginProvider(e).then(function(){n.props.handleClose()})},n}return Object(f.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(ue.a,{title:"Profile",visible:this.props.isOpen,onOk:this.props.handleClose,onCancel:this.props.handleClose,okButtonProps:{disabled:!this.props.auth.uid},cancelButtonProps:{disabled:!this.props.auth.uid}},r.a.createElement("div",null,r.a.createElement(he,{level:4},"Login with"),r.a.createElement(de.a,null,r.a.createElement(pe.a,{span:24},r.a.createElement(be,null,r.a.createElement(se.a,{onClick:function(){return e.handleTryLogin("github")},style:{margin:5}},r.a.createElement(O.a,{style:{fontSize:24},type:"github"})),r.a.createElement(se.a,{onClick:function(){return e.handleTryLogin("google")}},r.a.createElement(O.a,{style:{fontSize:24},type:"google"})))))))}}]),t}(a.Component),Oe=Object(o.b)(function(e){return{auth:e.auth}},{tryLoginProvider:function(e){return function(t){var n=null;if("github"===e)n=z;else{if("google"!==e)return Promise.reject("Invalid auth provider");n=H}return K.signInWithPopup(n).then(function(e){var n=e.user;if(console.log({user:n}),n)return t({type:"UPDATE_USER_ROOM_PRESENCE"})}).catch(function(e){console.log({error:e}),e.code,e.message})}}})(ge);function ve(){var e=Object(h.a)(["\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n"]);return ve=function(){return e},e}function je(){var e=Object(h.a)(["\n\tbackground: none;\n\tborder: 1px solid transparent;\n\tborder-radius: 4px;\n\ttransition: border 0.5s;\n\toutline: none;\n\tpadding: 0px;\n\tline-height: normal;\n\tcursor: pointer;\n"]);return je=function(){return e},e}var Ee=g.a.Header,ye=ce.a.Title,xe=b.a.button(je()),ke=b.a.div(ve()),Ce=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={profileOpen:!1},n.handleProfileOpen=function(){n.setState({profileOpen:!0})},n.handleProfileClose=function(){n.setState({profileOpen:!1})},n}return Object(f.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props,t=e.room,n=e.uid,a=e.photoURL;r.a.createElement(v.b,null,r.a.createElement(v.b.Item,{onClick:this.handleProfileOpen},r.a.createElement("a",null,"Profile")));return r.a.createElement(Ee,{style:{background:"#fff",borderBottom:"1px solid #acacac",padding:16,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"}},r.a.createElement(ye,{style:{margin:0},level:3},"# ",t?t.name:""),!!n&&r.a.createElement(ke,null,r.a.createElement(se.a,{shape:"circle",style:{paddingTop:1,marginRight:10}},r.a.createElement(O.a,{type:"setting"})),r.a.createElement(xe,{onClick:this.handleProfileOpen},r.a.createElement(k.a,{src:a,size:35,shape:"square"})),r.a.createElement(Oe,{isOpen:this.state.profileOpen,handleClose:this.handleProfileClose})))}}]),t}(a.Component),we=Object(o.b)(function(e){var t=e.auth;return{uid:t.uid,photoURL:t.photoURL}})(Ce),Re=n(213),Se=function(e,t){return new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()},Ae=Object(Re.a)(function(e,t){var n=t.match.params.roomId;return e.rooms.joined[n]},function(e,t){var n=t.match.params.roomId,a=e.rooms.joined[n];return a?Object.values(a.messages).sort(Se):[]},function(e){return e.auth},function(e,t,n){return{auth:n,room:e,messages:t,isLoading:!e}});function Ie(){var e=Object(h.a)(["\n\tpadding-top: 8px;\n\tpadding-bottom: 8px;\n\tflex-grow: 1;\n\toverflow-y: scroll;\n\toverflow-x: hidden;\n"]);return Ie=function(){return e},e}function De(){var e=Object(h.a)(["\n\t/* height: 100%; */\n\twidth: 100%;\n\tpadding: 24;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: '#fff';\n"]);return De=function(){return e},e}var Te=g.a.Content,_e=b.a.div(De()),Ne=b.a.div(Ie()),Le=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).messagesEnd=null,n.messagesContainer=null,n.scrollToBottom=function(){n.messagesEnd&&n.messagesEnd.scrollIntoView({behavior:"auto"})},n}return Object(f.a)(t,e),Object(d.a)(t,[{key:"componentWillMount",value:function(){var e=this.props.match.params.roomId;console.log(e)}},{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(e){if(0===e.messages.length&&this.props.messages.length>0)this.scrollToBottom();else if(e.room&&this.props.room&&e.room.id!==this.props.room.id)this.scrollToBottom();else if(e.messages.length!==this.props.messages.length&&e.messages.length>0&&this.props.messages.length>0){var t=e.messages.slice(-1)[0],n=this.props.messages.slice(-1)[0];if(t.id!==n.id&&n&&n.sender.uid===this.props.auth.uid)this.scrollToBottom();else if(this.messagesContainer){var a=this.messagesContainer,r=a.scrollHeight,o=a.scrollTop,i=(a.offsetHeight,a.clientHeight);Math.abs(i-(r-o-45))<45&&this.scrollToBottom()}}}},{key:"render",value:function(){var e=this,t=this.props,n=t.room,o=t.messages,i=t.isLoading,c=r.a.createElement(x,null);return i||(c=r.a.createElement(_e,null,r.a.createElement(Ne,{ref:function(t){e.messagesContainer=t}},o.map(function(e,t){return r.a.createElement(_,{isConsecutive:!!o[t-1]&&o[t-1].sender.uid===e.sender.uid,name:e.sender.displayName||"",key:e.id},e.text)}),r.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}})),r.a.createElement(ie,{room:this.props.room}))),r.a.createElement(a.Fragment,null,r.a.createElement(we,{room:n}),r.a.createElement(Te,{style:{margin:"0px 16px 24px 16px",overflow:"initial",display:"flex"}},c))}}]),t}(a.Component),Pe=Object(o.b)(function(e,t){return Ae(e,t)},{trySendMessage:Y})(Le),Me=n(41);function Be(){var e=Object(h.a)(["\n\tmargin-top: 5px;\n\tmargin-bottom: 5px;\n"]);return Be=function(){return e},e}var Ue=le.a.TextArea,Je=ce.a.Text,Ge=b.a.div(Be()),ze=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={roomName:"",description:""},n.handleChange=function(e){console.log(e.target.name),n.setState(Object(Me.a)({},e.target.name,e.target.value))},n.handleSubmit=function(){var e=n.props.auth,t=e.uid,a=e.displayName;if(t){console.log("Create this room pls");var r=n.state.roomName;if(r&&r.length>0){var o={name:r,people:{id:t,name:a,unread:0,lastRead:0}};n.props.tryCreateRoom(o),n.props.handleClose()}}},n}return Object(f.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement(ue.a,{title:"Create Room",visible:this.props.isOpen,onOk:this.handleSubmit,onCancel:this.props.handleClose,okButtonProps:{disabled:!this.props.auth.uid},cancelButtonProps:{disabled:!this.props.auth.uid}},r.a.createElement(Ge,null,r.a.createElement(Je,null,"Name:")),r.a.createElement(le.a,{name:"roomName",value:this.state.roomName,onChange:this.handleChange}),r.a.createElement(Ge,null,r.a.createElement(Je,null,"Description:")),r.a.createElement(Ue,{name:"description",value:this.state.description,onChange:this.handleChange,rows:4}))}}]),t}(a.Component),He=Object(o.b)(function(e){return{auth:e.auth}},{tryCreateRoom:function(e,t){return function(n,a){var r={name:e.name};return G.collection("rooms").get().then(function(a){var o=[];return a.forEach(function(e){console.log(e);var t=e.data();o.push(Object(N.a)({},t))}),o.find(function(e){return e.name===r.name})?t("Room name not available!"):G.collection("rooms").add(r).then(function(t){return G.collection("rooms/".concat(t.id,"/people")).doc(e.people.id).set(e.people).then(function(){G.collection("users/".concat(e.people.id,"/rooms")).doc(t.id).set({roomName:r.name}),n(X(Object(N.a)({id:t.id},e,{people:[e.people]}))),e.people.name})})})}}})(ze),Ke=n(402);function We(){var e=Object(h.a)(["\n\tpadding: 10px;\n"]);return We=function(){return e},e}var Ve=b.a.div(We()),qe=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).handleJoinRoom=function(e){if(!e.canJoin)return console.log("redirect to that room"),void n.props.handleClose();n.props.tryJoinRoom(e.id)},n}return Object(f.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(ue.a,{title:"Browse Rooms",visible:this.props.isOpen,onOk:this.props.handleClose,onCancel:this.props.handleClose,okButtonProps:{disabled:!this.props.auth.uid},cancelButtonProps:{disabled:!this.props.auth.uid},bodyStyle:{maxHeight:450,overflowY:"scroll"}},r.a.createElement(Ke.a,{dataSource:this.props.roomList,renderItem:function(t){return r.a.createElement(Ke.a.Item,{key:t.id},r.a.createElement(Ke.a.Item.Meta,{avatar:t.avatarUrl?r.a.createElement(k.a,{src:t.avatarUrl}):null,title:r.a.createElement("a",{onClick:function(){return e.handleJoinRoom(t)}},t.name),description:"TODO room descriptions"}),r.a.createElement("div",null,t.canJoin?r.a.createElement(se.a,{onClick:function(){return e.handleJoinRoom(t)}},"Join"):r.a.createElement(Ve,null,"joined")))}}," "))}}]),t}(a.Component),Xe=Object(o.b)(function(e){var t=e.rooms,n=t.available,a=t.joined;return{roomList:Object.values(n).map(function(e){var t=void 0===Object.values(a).find(function(t){return t.id===e.id});return Object(N.a)({},e,{canJoin:t})}),auth:e.auth}},{tryJoinRoom:function(e){return{type:"JOIN_ROOM_SAGA",roomId:e}}})(qe);n(388);function Fe(){var e=Object(h.a)(["\n\tfont-size: 16px;\n\tbackground: none;\n\tborder: none;\n\t-webkit-transition: color 0.5s;\n\ttransition: color 0.5s;\n\tcursor: pointer;\n\t&:hover {\n\t\tcolor: #fff;\n\t}\n"]);return Fe=function(){return e},e}function Ye(){var e=Object(h.a)(["\n\tpadding: 10px;\n\tcolor: rgba(255, 255, 255, 0.65);\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n"]);return Ye=function(){return e},e}function Ze(){var e=Object(h.a)(["\n\theight: 100%;\n"]);return Ze=function(){return e},e}function Qe(){var e=Object(h.a)(["\n\ttext-align: center;\n\tpadding: 10px;\n\theight: 64px;\n\tborder-bottom: 1px solid grey;\n"]);return Qe=function(){return e},e}var $e=g.a.Sider,et=b.a.div(Qe()),tt=b.a.img(Ze()),nt=b.a.div(Ye()),at=b.a.button(Fe()),rt=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={openDialog:!1},n.handleCloseDialog=function(){n.setState({openDialog:!1})},n.handleOpenDialog=function(e){n.setState({openDialog:e})},n.handleRoomSelect=function(e){var t=e.key;n.props.history.push(t)},n}return Object(f.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.props.initAuth()}},{key:"componentWillUpdate",value:function(e){!this.props.auth.uid&&e.auth.uid&&this.props.initSlacker()}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.location,a=t.joinedRooms,r=t.history;"/"===n.pathname&&0===e.joinedRooms.length&&0!==a.length&&(console.log("redirect to first room?"),r.push("/r/".concat(a[0].id)))}},{key:"render",value:function(){var e=this;return r.a.createElement(g.a,{style:{height:"100%"}},r.a.createElement($e,{style:{overflow:"auto",height:"100vh",position:"fixed",left:0}},r.a.createElement(et,null,r.a.createElement(tt,{src:"fox.png"})),r.a.createElement(nt,null,r.a.createElement(at,{onClick:function(){return e.handleOpenDialog("browseRooms")}},r.a.createElement("span",null,"Rooms:")),r.a.createElement(at,{onClick:function(){return e.handleOpenDialog("createRoom")}},r.a.createElement(O.a,{type:"plus-circle"}))),r.a.createElement(He,{isOpen:"createRoom"===this.state.openDialog,handleClose:this.handleCloseDialog}),r.a.createElement(Xe,{isOpen:"browseRooms"===this.state.openDialog,handleClose:this.handleCloseDialog}),r.a.createElement(v.b,{theme:"dark",mode:"inline",onSelect:this.handleRoomSelect,selectedKeys:[this.props.location.pathname]},this.props.joinedRooms.map(function(e){return r.a.createElement(v.b.Item,{key:"/r/".concat(e.id)},r.a.createElement("span",{className:"nav-text"},"# ",e.name))}))),r.a.createElement(g.a,{style:{marginLeft:200,background:"#fff"}},r.a.createElement(c.c,null,r.a.createElement(c.a,{path:"/r/:roomId",component:Pe}),r.a.createElement(c.a,{path:"/"},0===this.props.joinedRooms.length?r.a.createElement(x,null):r.a.createElement("div",null,"No chat selected")))))}}]),t}(a.Component),ot=Object(o.b)(function(e){return{auth:e.auth,joinedRooms:Object.values(e.rooms.joined),availableRooms:Object.values(e.rooms.available)}},{initAuth:function(){return function(e){return K.onAuthStateChanged(function(t){if(t){if(t){var n={displayName:t.displayName||"Ninja",email:t.email,photoURL:t.photoURL};return e(function(e,t){return{type:"LOGIN",uid:e,userData:t}}(t.uid,n))}}else me()(e)})}},initSlacker:function(){return{type:"INIT_SLACKER_SAGA"}}})(rt),it=n(51),ct=n(215),st=n(86),lt={joined:{},available:{}},ut=Object(it.c)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":return Object(N.a)({uid:t.uid},t.userData);case"LOGOUT":return{};default:return e}},rooms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:lt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CREATE_ROOM":case"JOINED_ROOM":return Object(N.a)({},e,{joined:Object(N.a)({},e.joined,Object(Me.a)({},t.room.id,t.room))});case"AVAILABLE_ROOMS":return Object(N.a)({},e,{available:Object(N.a)({},t.rooms.reduce(function(e,t){return Object(N.a)({},e,Object(Me.a)({},t.id,t))},{}))});case"SEND_MESSAGE":return Object(N.a)({},e,{joined:Object(N.a)({},e.joined,Object(Me.a)({},t.roomId,Object(N.a)({},[e.joined[t.roomId]],{messages:Object(N.a)({},e.joined[t.roomId].messages,Object(Me.a)({},t.message.id,t.message))})))});case"UPDATE_MESSAGES":return Object(N.a)({},e,{joined:Object(N.a)({},e.joined,Object(Me.a)({},t.roomId,Object(N.a)({},e.joined[t.roomId],{messages:Object(N.a)({},e.joined[t.roomId].messages,t.messages.reduce(function(e,t){return Object(N.a)({},e,Object(Me.a)({},t.id,t))},{}))})))});default:return e}},redirect:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REDIRECT_TO":return{redirectTo:t.redirectTo};default:return e}}}),dt=n(23),pt=n.n(dt),mt=n(216),ft=n(15),ht=pt.a.mark(Ot),bt=pt.a.mark(vt),gt=pt.a.mark(jt);function Ot(e){var t,n,a,r,o,i,c;return pt.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return console.log("try fetch room ",e),t=G.collection("rooms").doc(e),s.next=4,Object(ft.call)(J.firestore.getDocument,t);case 4:if(!(n=s.sent).exists){s.next=24;break}return a=n.data(),r=[],o={},s.next=11,Object(ft.call)(J.firestore.getCollection,t.collection("people"));case 11:return s.sent.forEach(function(e){r.push(Object(N.a)({id:e.id},e.data()))}),console.log({people:r}),i=t.collection("messages").orderBy("createdAt","desc").limit(25),s.next=17,Object(ft.call)(J.firestore.getCollection,i);case 17:return s.sent.forEach(function(e){o[e.id]=Object(N.a)({id:e.id},e.data())}),s.next=21,Object(ft.put)(X({id:t.id,name:a?a.name:"Error",people:r,messages:o}));case 21:return c=t.collection("messages").orderBy("createdAt","desc").limit(1),s.next=24,Object(ft.fork)(J.firestore.syncCollection,c,{successActionCreator:function(t){return Q(t,e)}});case 24:case"end":return s.stop()}},ht)}function vt(e){var t,n,a,r,o,i,c,s,l,u;return pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(ft.select)(function(e){return e.auth});case 2:if((t=e.sent).uid){e.next=6;break}return console.log("no auth!"),e.abrupt("return");case 6:return n=G.collection("rooms").get(),e.next=9,n;case 9:return a=e.sent,r=[],a.forEach(function(e){var t=Object(N.a)({id:e.id},e.data());r.push(t)}),e.next=14,Object(ft.put)(Z(r));case 14:return o=r.find(function(e){return"general"===e.name}),e.next=17,Object(ft.call)(J.firestore.getCollection,"users/".concat(t.uid,"/rooms"));case 17:if((i=e.sent).empty){e.next=35;break}c=[],i.forEach(function(e){return c.push(e.id)}),s=0,l=c;case 22:if(!(s<l.length)){e.next=30;break}return u=l[s],e.next=26,Object(ft.fork)(Ot,u);case 26:e.sent;case 27:s++,e.next=22;break;case 30:if(!o||c.includes(o.id)){e.next=33;break}return e.next=33,Object(ft.put)({type:"JOIN_ROOM_SAGA",roomId:o.id,room:o});case 33:e.next=38;break;case 35:if(!o){e.next=38;break}return e.next=38,Object(ft.put)({type:"JOIN_ROOM_SAGA",roomId:o.id,room:o});case 38:case"end":return e.stop()}},bt)}function jt(){return pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(ft.takeLatest)("INIT_SLACKER_SAGA",vt);case 2:case"end":return e.stop()}},gt)}var Et=jt,yt=n(218),xt=pt.a.mark(Rt),kt=pt.a.mark(St),Ct=pt.a.mark(At),wt=pt.a.mark(It);function Rt(e){var t,n,a,r,o;return pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(ft.select)(function(e){return e.auth});case 2:return t=e.sent,t.uid,n=Object(yt.a)(t,["uid"]),e.next=6,Object(ft.call)(J.firestore.getCollection,"users/".concat(t.uid,"/rooms"));case 6:if((a=e.sent).empty){e.next=17;break}r=[],a.forEach(function(e){r.push(e.id)}),e.t0=pt.a.keys(r);case 11:if((e.t1=e.t0()).done){e.next=17;break}return o=e.t1.value,e.next=15,Object(ft.call)(J.firestore.setDocument,"rooms/".concat(o,"/people/").concat(t.uid),Object(N.a)({id:t.uid},n));case 15:e.next=11;break;case 17:case"end":return e.stop()}},xt)}function St(e){var t,n,a,r,o,i,c,s,l;return pt.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return t=e.roomId,u.next=3,Object(ft.select)(function(e){return e.auth});case 3:return n=u.sent,a=n.uid,r=n.displayName,o=n.photoURL,i=G.doc("rooms/".concat(t)),u.next=10,Object(ft.call)(J.firestore.getDocument,i);case 10:if(c=u.sent,(s=Object(N.a)({id:c.id},c.data()))&&c.exists){u.next=18;break}return u.next=15,Object(ft.put)(F("Room not found!"));case 15:return u.abrupt("return");case 18:if(!s.people||!s.people.find(function(e){return e.id===a})){u.next=22;break}return u.abrupt("return");case 22:return l={name:r,photoURL:o,id:a,unread:0,lastRead:0},console.log({person:l}),u.next=26,Object(ft.call)(J.firestore.setDocument,"rooms/".concat(t,"/people/").concat(l.id),l);case 26:return u.next=28,Object(ft.call)(J.firestore.setDocument,"users/".concat(l.id,"/rooms/").concat(t),{roomName:s.name});case 28:return u.next=30,Object(ft.call)(Ot,t);case 30:case"end":return u.stop()}},kt)}function At(){return pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(ft.takeEvery)("JOIN_ROOM_SAGA",St);case 2:case"end":return e.stop()}},Ct)}function It(){return pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(ft.takeEvery)("UPDATE_ROOM_PRESENCES",Rt);case 2:case"end":return e.stop()}},wt)}var Dt=[At(),It()],Tt=pt.a.mark(_t);function _t(){return pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(ft.all)([Et()].concat(Object(mt.a)(Dt)));case 2:case"end":return e.stop()}},Tt)}var Nt=Object(st.default)(),Lt=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||it.d,Pt=function(){var e=Object(it.e)(ut,Lt(Object(it.a)(ct.a,Nt)));return Nt.run(_t),e}(),Mt=r.a.createElement(o.a,{store:Pt},r.a.createElement(i.a,null,r.a.createElement(c.a,{path:"/",component:ot})));l.a.render(Mt,document.getElementById("container"))}},[[220,1,2]]]);
//# sourceMappingURL=main.f7fa3fcd.chunk.js.map