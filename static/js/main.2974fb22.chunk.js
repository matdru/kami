(window.webpackJsonpkami=window.webpackJsonpkami||[]).push([[0],{169:function(e,t,n){e.exports=n(269)},267:function(e,t,n){},269:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),a=n(29),c=n(119),i=n(61),s=n(6),l=n.n(s),u=(n(178),n(31)),p=n(32),f=n(35),d=n(33),m=n(36),h=n(18),b=n(19),O=n(275),g=n(11),v=n(280),y=n(38),j=n(149),E=n.n(j),w=n(272);function x(){var e=Object(h.a)(["\n\tcolor: black;\n\tfont-weight: bold;\n\tmargin-top: 2px;\n"]);return x=function(){return e},e}function k(){var e=Object(h.a)(["\n\tcolor: black;\n"]);return k=function(){return e},e}function P(){var e=Object(h.a)(["\n\twidth: 46px;\n\tpadding: 5px;\n"]);return P=function(){return e},e}function S(){var e=Object(h.a)(["\n\tdisplay: flex;\n\tflex-direction: row;\n\tmargin-bottom: 2px;\n"]);return S=function(){return e},e}var C=b.a.div(S()),R=b.a.div(P()),D=b.a.div(k()),M=b.a.div(x()),A=function(e){var t=e.children,n=e.name,r=e.photoURL;return e.isConsecutive?o.a.createElement(C,null,o.a.createElement(R,null),o.a.createElement(D,null,t)):o.a.createElement(C,null,o.a.createElement(R,null,o.a.createElement(w.a,{src:r,size:35,shape:"square",icon:"user"})),o.a.createElement(D,null,o.a.createElement(M,null,n),t))},I=n(67),T=n.n(I),L=(n(141),n(155)),_=n.n(L),U=T.a.initializeApp({apiKey:"AIzaSyB2tCxT6yP0CWtCbD9JDj3ZKaxxW8T25PI",authDomain:"slacker-c3b01.firebaseapp.com",databaseURL:"https://slacker-c3b01.firebaseio.com",projectId:"slacker-c3b01",storageBucket:"slacker-c3b01.appspot.com",messagingSenderId:"286218247810"}),N=new _.a(U),B=T.a.firestore(),F=U.functions("europe-west1"),H=new T.a.auth.GithubAuthProvider,G=new T.a.auth.GoogleAuthProvider,J=T.a.auth(),V={sendMessage:F.httpsCallable("sendMessage"),joinRoom:F.httpsCallable("joinRoom"),leaveRoom:F.httpsCallable("leaveRoom"),getRoomUsers:F.httpsCallable("getRoomUsers")},z=function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(n,r){if(r().auth){var o={text:e,roomId:t};return V.sendMessage(o)}}};function K(){var e=Object(h.a)(["\n\tflex-shrink: 0;\n\tpadding: 0px 15px;\n\tbackground: none;\n\tborder: none;\n"]);return K=function(){return e},e}function W(){var e=Object(h.a)(["\n\tpadding-left: 14px;\n\tborder: none;\n\tborder-radius: 4px;\n\tflex-grow: 1;\n\toutline: none;\n"]);return W=function(){return e},e}function q(){var e=Object(h.a)(["\n\theight: 44px;\n\tbackground-color: #fff;\n\tborder-radius: 4px;\n\tborder: 1px solid #acacac;\n\tdisplay: flex;\n\tflex-direction: row;\n\tflex-shrink: 0;\n"]);return q=function(){return e},e}var X=b.a.form(q()),Q=b.a.input(W()),Y=b.a.button(K()),Z=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(n=Object(f.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).state={value:""},n.handleTyping=function(e){n.setState({value:e.target.value})},n.handleSend=function(e){e.preventDefault();var t=n.props.room,r=n.state.value;t&&t.id&&r.length>0&&(n.props.trySendMessage(r,t.id),n.setState({value:""}))},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return o.a.createElement(X,{onSubmit:this.handleSend},o.a.createElement(Q,{value:this.state.value,onChange:this.handleTyping}),o.a.createElement(Y,{type:"submit"},"Send"))}}]),t}(r.Component),$=Object(a.b)(null,{trySendMessage:z})(Z),ee=n(156);function te(){var e=Object(h.a)(["\n\twidth: 100%;\n\tpadding: 24;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: '#fff';\n\tjustify-content: center;\n\talign-items: center;\n"]);return te=function(){return e},e}var ne=b.a.div(te()),re=function(){return o.a.createElement(ne,null,o.a.createElement(ee.a,{size:"large"}))};function oe(){var e=Object(h.a)(["\n\tfloat: left;\n\tclear: both;\n"]);return oe=function(){return e},e}function ae(){var e=Object(h.a)(["\n\twidth: 100%;\n\theight: 60px;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n"]);return ae=function(){return e},e}function ce(){var e=Object(h.a)(["\n\tpadding-top: 8px;\n\tpadding-bottom: 8px;\n\tflex-grow: 1;\n\toverflow-y: scroll;\n\toverflow-x: hidden;\n"]);return ce=function(){return e},e}function ie(){var e=Object(h.a)(["\n\t/* height: 100%; */\n\twidth: 100%;\n\tpadding: 24;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: '#fff';\n"]);return ie=function(){return e},e}var se=b.a.div(ie()),le=b.a.div(ce()),ue=b.a.div(ae()),pe=b.a.div(oe()),fe=function(e){var t=e.room,n=e.messages,r=e.getMessagesRef,a=e.getBottomAnchorRef,c=e.onMessagesScroll,i=e.onLoadMoreVisibilityChange;return o.a.createElement(se,null,o.a.createElement(le,{onScroll:c,ref:r},!!t&&t.canFetchMore&&!t.isFetchingMore&&o.a.createElement(ue,null,o.a.createElement(E.a,{onChange:i},o.a.createElement(y.a,null,"Load more"))),!!t&&t.isFetchingMore&&o.a.createElement(ue,null,o.a.createElement(re,null)),n.map(function(e,t){return o.a.createElement(A,{isConsecutive:!!n[t-1]&&n[t-1].sender.uid===e.sender.uid,name:e.sender.displayName||"Ninja",photoURL:e.sender.photoURL||void 0,key:e.id},e.text)}),o.a.createElement(pe,{ref:a})),o.a.createElement($,{room:t}))},de=n(277),me=n(278),he=n(279),be=n(273),Oe=n(274),ge="UPDATE_ROOM_PRESENCES",ve="FETCH_MORE_MESSAGES_SAGA",ye="JOIN_ROOM_SAGA",je="LEAVE_ROOM_SAGA",Ee="INIT_SLACKER_SAGA",we=function(e){return function(t){return t({type:"FETCH_ROOM_USERS_REQUEST"}),V.getRoomUsers({roomId:e}).then(function(e){var n={};e.data.forEach(function(e){n[e.id]=e}),console.log(n),t({type:"FETCH_ROOM_USERS_SUCCESS",payload:n})}).catch(function(){t({type:"FETCH_ROOM_USERS_FAILURE"})})}},xe=function(e){return{type:"LOGIN",error:e}},ke=function(){return function(e){return J.signInAnonymously().then(function(){}).catch(function(t){return console.log({error:t}),e(xe({error:t}))})}};function Pe(){var e=Object(h.a)(["\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: center;\n\talign-items: center;\n"]);return Pe=function(){return e},e}var Se=de.a.Title,Ce=b.a.div(Pe()),Re=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(n=Object(f.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).handleTryLogin=function(e){n.props.tryLoginProvider(e).then(function(){n.props.handleClose()})},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(me.a,{title:"Profile",visible:this.props.isOpen,onOk:this.props.handleClose,onCancel:this.props.handleClose,okButtonProps:{disabled:!this.props.auth.uid},cancelButtonProps:{disabled:!this.props.auth.uid}},o.a.createElement("div",null,o.a.createElement(Se,{level:4},"Login with"),o.a.createElement(be.a,null,o.a.createElement(Oe.a,{span:24},o.a.createElement(Ce,null,o.a.createElement(y.a,{onClick:function(){return e.handleTryLogin("github")},style:{margin:5}},o.a.createElement(g.a,{style:{fontSize:24},type:"github"})),o.a.createElement(y.a,{onClick:function(){return e.handleTryLogin("google")}},o.a.createElement(g.a,{style:{fontSize:24},type:"google"})))))))}}]),t}(r.Component),De=Object(a.b)(function(e){return{auth:e.auth}},{tryLoginProvider:function(e){return function(t){var n=null;if("github"===e)n=H;else{if("google"!==e)return Promise.reject("Invalid auth provider");n=G}return J.signInWithPopup(n).then(function(e){var n=e.user;if(console.log({user:n}),n)return t({type:"UPDATE_USER_ROOM_PRESENCE"})}).catch(function(e){return console.log({error:e}),t(xe({error:e}))})}}})(Re),Me=n(23);function Ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ae(n,!0).forEach(function(t){Object(Me.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ae(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Te=function(e){return{type:"UPDATE_ROOM",room:e}},Le=function(e){return{type:"UPDATE_AVAILABLE_ROOMS",rooms:e}},_e=function(e,t){var n={};return e.forEach(function(e){n[e.id]=Ie({id:e.id},e.data())}),Ue(n,t)},Ue=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return{type:"UPDATE_MESSAGES",messages:e,canFetchMore:n,roomId:t}};function Ne(){var e=Object(h.a)(["\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n"]);return Ne=function(){return e},e}function Be(){var e=Object(h.a)(["\n\tbackground: none;\n\tborder: 1px solid transparent;\n\tborder-radius: 4px;\n\ttransition: border 0.5s;\n\toutline: none;\n\tpadding: 0px;\n\tline-height: normal;\n\tcursor: pointer;\n"]);return Be=function(){return e},e}var Fe=O.a.Header,He=de.a.Title,Ge=me.a.confirm,Je=b.a.button(Be()),Ve=b.a.div(Ne()),ze=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(n=Object(f.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).state={profileOpen:!1},n.handleProfileOpen=function(){n.setState({profileOpen:!0})},n.handleProfileClose=function(){n.setState({profileOpen:!1})},n.handleUsersFetch=function(){var e=n.props.room;e&&n.props.getRoomUsers(e.id)},n.handleConfirmLeave=function(){var e=n.props.room;if(e){Ge({title:"Do you want to leave this room?",content:n.props.room?n.props.room.name:"-",onOk:function(){n.props.tryLeaveRoom(e.id)},onCancel:function(){}})}},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.props,t=e.room,n=e.uid,r=e.photoURL,a=o.a.createElement(v.a,null,o.a.createElement(v.a.Item,{onClick:this.handleConfirmLeave},o.a.createElement("a",null,"Leave chat")),o.a.createElement(v.a.Item,{onClick:this.handleUsersFetch},o.a.createElement("a",null,"Fetch room users")));return o.a.createElement(Fe,{style:{background:"#fff",borderBottom:"1px solid #acacac",padding:16,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"}},o.a.createElement(He,{style:{margin:0},level:3},"# ",t?t.name:""),!!n&&o.a.createElement(Ve,null,o.a.createElement(he.a,{overlay:a,trigger:["click"],placement:"bottomRight"},o.a.createElement(y.a,{icon:"setting",shape:"circle",style:{paddingTop:1,marginRight:10}})),o.a.createElement(Je,{onClick:this.handleProfileOpen},o.a.createElement(w.a,{src:r,size:35,shape:"square"})),o.a.createElement(De,{isOpen:this.state.profileOpen,handleClose:this.handleProfileClose})))}}]),t}(r.Component),Ke=Object(a.b)(function(e){var t=e.auth;return{uid:t.uid,photoURL:t.photoURL||void 0}},{tryLeaveRoom:function(e){return{type:je,roomId:e}},getRoomUsers:we})(ze),We=O.a.Content,qe=function(e){var t=e.room,n=e.children,a=e.isLoading;return o.a.createElement(r.Fragment,null,o.a.createElement(Ke,{room:t}),o.a.createElement(We,{style:{margin:"0px 16px 24px 16px",overflow:"initial",display:"flex"}},a?o.a.createElement(re,null):n))},Xe=n(163),Qe=function(e,t){return new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()};function Ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ye(n,!0).forEach(function(t){Object(Me.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ye(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var $e=function(e){return function(t){var n=t.rooms.active[e];return Object.values(n.messages).sort(Qe)[0]||null}},et=Object(Xe.a)(function(e,t){var n=t.match.params.roomId;return e.rooms.active[n]},function(e,t){var n=t.match.params.roomId,r=e.rooms.active[n],o=(r?Object.values(r.messages).sort(Qe):[]).map(function(t){if(t.sender.uid){var n=e.users[t.sender.uid];return Ze({},t,{sender:Ze({},t.sender,{photoURL:n.photoURL||void 0,displayName:n.name||t.sender.displayName})})}return t});return console.log({roomMessages:o}),o},function(e){return e.auth},function(e,t,n){return{auth:n,room:e,messages:t,isLoading:!e}}),tt=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(f.a)(this,Object(d.a)(t).call(this,e))).messagesEnd=null,n.messagesContainer=null,n.scrollData=null,n.getMessagesRef=function(e){n.messagesContainer=e},n.handleMessagesScroll=function(e){if(e&&e.target){var t=e.target;n.scrollData={scrollHeight:t.scrollHeight,scrollTop:t.scrollTop,clientHeight:t.clientHeight}}},n.scrollToBottom=function(){n.messagesEnd&&n.messagesEnd.scrollIntoView({behavior:"auto"})},n.handleLoadMoreVisibilityChange=function(e){var t=n.props.room;e&&!1===n.state.loadMoreVisible&&t&&n.props.tryFetchMoreMessages(t.id),n.setState({loadMoreVisible:e})},n.state={loadMoreVisible:null},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(e){if(0===e.messages.length&&this.props.messages.length>0)this.scrollToBottom();else if(e.room&&this.props.room&&e.room.id!==this.props.room.id)this.scrollToBottom();else if(e.messages.length!==this.props.messages.length&&e.messages.length>0&&this.props.messages.length>0){var t=e.messages.slice(-1)[0],n=this.props.messages.slice(-1)[0];if(t.id!==n.id){if(n&&n.sender.uid===this.props.auth.uid)this.scrollToBottom();else if(this.messagesContainer){var r=this.messagesContainer,o=r.scrollHeight,a=r.scrollTop,c=r.clientHeight;Math.abs(c-(o-a-45))<45&&this.scrollToBottom()}}else if(this.scrollData&&this.messagesContainer){var i=this.scrollData,s=i.scrollHeight,l=i.scrollTop,u=s-i.clientHeight-l;if(u>0){var p=this.messagesContainer.scrollHeight-this.messagesContainer.clientHeight-u;this.messagesContainer.scrollTo({top:p})}}}}},{key:"render",value:function(){var e=this,t=this.props,n=t.room,r=t.messages,a=t.isLoading;return o.a.createElement(qe,{room:n,isLoading:a},o.a.createElement(fe,{room:n,messages:r,onLoadMoreVisibilityChange:this.handleLoadMoreVisibilityChange,onMessagesScroll:this.handleMessagesScroll,getMessagesRef:this.getMessagesRef,getBottomAnchorRef:function(t){return e.messagesEnd=t}}))}}]),t}(r.Component),nt=Object(a.b)(function(e,t){return et(e,t)},{trySendMessage:z,tryFetchMoreMessages:function(e){return{type:ve,roomId:e}}})(tt),rt=n(281);function ot(){var e=Object(h.a)(["\n\tmargin-top: 5px;\n\tmargin-bottom: 5px;\n"]);return ot=function(){return e},e}var at=rt.a.TextArea,ct=de.a.Text,it=b.a.div(ot()),st=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(n=Object(f.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).state={roomName:"",description:""},n.handleChange=function(e){console.log(e.target.name),n.setState(Object(Me.a)({},e.target.name,e.target.value))},n.handleSubmit=function(){var e=n.props.auth,t=e.uid,r=e.displayName;if(t){console.log("Create this room pls");var o=n.state.roomName;if(o&&o.length>0){var a={name:o,people:{id:t,name:r,unread:0,lastRead:0}};n.props.tryCreateRoom(a),n.props.handleClose()}}},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return o.a.createElement(me.a,{title:"Create Room",visible:this.props.isOpen,onOk:this.handleSubmit,onCancel:this.props.handleClose,okButtonProps:{disabled:!this.props.auth.uid},cancelButtonProps:{disabled:!this.props.auth.uid}},o.a.createElement(it,null,o.a.createElement(ct,null,"Name:")),o.a.createElement(rt.a,{name:"roomName",value:this.state.roomName,onChange:this.handleChange}),o.a.createElement(it,null,o.a.createElement(ct,null,"Description:")),o.a.createElement(at,{name:"description",value:this.state.description,onChange:this.handleChange,rows:4}))}}]),t}(r.Component),lt=Object(a.b)(function(e){return{auth:e.auth}},{tryCreateRoom:function(e,t){return function(n,r){var o={name:e.name};return B.collection("rooms").get().then(function(a){var c=[];return a.forEach(function(e){console.log(e);var t=e.data();c.push(Ie({},t))}),c.find(function(e){return e.name===o.name})?t("Room name not available!"):B.collection("rooms").add(o).then(function(t){return B.collection("rooms/".concat(t.id,"/people")).doc(e.people.id).set(e.people).then(function(){B.collection("users/".concat(e.people.id,"/rooms")).doc(t.id).set({roomName:o.name}),n(Te(Ie({id:t.id},e,{people:[e.people]})));var a=r().auth;a&&n(z("".concat(a.displayName," created this room"),t.id))})})})}}})(st),ut=n(276);function pt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ft(){var e=Object(h.a)(["\n\tpadding: 10px;\n"]);return ft=function(){return e},e}var dt=b.a.div(ft()),mt=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(n=Object(f.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).handleJoinRoom=function(e){if(!e.canJoin)return console.log("redirect to that room"),void n.props.handleClose();n.props.tryJoinRoom(e.id)},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(me.a,{title:"Browse Rooms",visible:this.props.isOpen,onOk:this.props.handleClose,onCancel:this.props.handleClose,okButtonProps:{disabled:!this.props.auth.uid},cancelButtonProps:{disabled:!this.props.auth.uid},bodyStyle:{maxHeight:450,overflowY:"scroll"}},o.a.createElement(ut.a,{dataSource:this.props.roomList,renderItem:function(t){return o.a.createElement(ut.a.Item,{key:t.id},o.a.createElement(ut.a.Item.Meta,{avatar:t.avatarUrl?o.a.createElement(w.a,{src:t.avatarUrl}):null,title:o.a.createElement("button",{onClick:function(){return e.handleJoinRoom(t)}},t.name),description:"TODO room descriptions"}),o.a.createElement("div",null,t.canJoin?o.a.createElement(y.a,{onClick:function(){return e.handleJoinRoom(t)}},"Join"):o.a.createElement(dt,null,"Active")))}}," "))}}]),t}(r.Component),ht=Object(a.b)(function(e){var t=e.rooms,n=t.available,r=t.active;return{roomList:Object.values(n).map(function(e){var t=void 0===Object.values(r).find(function(t){return t.id===e.id});return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pt(n,!0).forEach(function(t){Object(Me.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pt(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e,{canJoin:t})}),auth:e.auth}},{tryJoinRoom:function(e){return{type:ye,roomId:e}}})(mt);n(267);function bt(){var e=Object(h.a)(["\n\theight: 100%;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n"]);return bt=function(){return e},e}function Ot(){var e=Object(h.a)(["\n\tfont-size: 16px;\n\tbackground: none;\n\tborder: none;\n\t-webkit-transition: color 0.5s;\n\ttransition: color 0.5s;\n\tcursor: pointer;\n\t&:hover {\n\t\tcolor: #fff;\n\t}\n"]);return Ot=function(){return e},e}function gt(){var e=Object(h.a)(["\n\tpadding: 10px;\n\tcolor: rgba(255, 255, 255, 0.65);\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n"]);return gt=function(){return e},e}function vt(){var e=Object(h.a)(["\n\theight: 100%;\n"]);return vt=function(){return e},e}function yt(){var e=Object(h.a)(["\n\ttext-align: center;\n\tpadding: 10px;\n\theight: 64px;\n\tborder-bottom: 1px solid grey;\n"]);return yt=function(){return e},e}var jt=O.a.Sider,Et=b.a.div(yt()),wt=b.a.img(vt()),xt=b.a.div(gt()),kt=b.a.button(Ot()),Pt=b.a.div(bt()),St=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(n=Object(f.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).state={openDialog:!1},n.handleCloseDialog=function(){n.setState({openDialog:!1})},n.handleOpenDialog=function(e){n.setState({openDialog:e})},n.handleRoomSelect=function(e){var t=e.key;n.props.history.push(t)},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.props.initAuth()}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.location,r=t.activeRooms,o=t.history;"/"===n.pathname&&0===e.activeRooms.length&&0!==r.length&&o.push("/r/".concat(r[0].id)),!e.auth.uid&&this.props.auth.uid&&this.props.initSlacker()}},{key:"render",value:function(){var e=this;return o.a.createElement(O.a,{style:{height:"100%"}},o.a.createElement(jt,{collapsedWidth:0,breakpoint:"lg"},o.a.createElement(Et,null,o.a.createElement(wt,{src:"fox.png"})),o.a.createElement(xt,null,o.a.createElement(kt,{onClick:function(){return e.handleOpenDialog("browseRooms")}},o.a.createElement("span",null,"Rooms:")),o.a.createElement(kt,{onClick:function(){return e.handleOpenDialog("createRoom")}},o.a.createElement(g.a,{type:"plus-circle"}))),o.a.createElement(lt,{isOpen:"createRoom"===this.state.openDialog,handleClose:this.handleCloseDialog}),o.a.createElement(ht,{isOpen:"browseRooms"===this.state.openDialog,handleClose:this.handleCloseDialog}),o.a.createElement(v.a,{theme:"dark",mode:"inline",onSelect:this.handleRoomSelect,selectedKeys:[this.props.location.pathname]},this.props.activeRooms.map(function(e){return o.a.createElement(v.a.Item,{key:"/r/".concat(e.id)},o.a.createElement("span",{className:"nav-text"},"# ",e.name))}))),o.a.createElement(O.a,{style:{background:"#fff"}},o.a.createElement(i.c,null,o.a.createElement(i.a,{path:"/r/:roomId",component:nt}),o.a.createElement(i.a,{path:"/"},o.a.createElement(Pt,null,0===this.props.activeRooms.length?o.a.createElement(re,null):o.a.createElement("div",null,"No chat selected"))))))}}]),t}(r.Component),Ct=Object(a.b)(function(e){return{auth:e.auth,activeRooms:Object.values(e.rooms.active),availableRooms:Object.values(e.rooms.available)}},{initAuth:function(){return function(e){return J.onAuthStateChanged(function(t){if(t){if(t){var n={id:t.uid,name:t.displayName||"Ninja",email:t.email,photoURL:t.photoURL};return console.log({userData:n,user:t}),e(function(e,t){return{type:"LOGIN",uid:e,userData:t}}(t.uid,n)),e(function(e){return function(t){B.doc("users/".concat(e.id)).set(e,{merge:!0}).then(function(){t({type:"USER_UPDATE_SUCCESS",payload:e})})}}(n))}}else ke()(e)})}},initSlacker:function(){return{type:Ee}}})(St),Rt=n(48),Dt=n(164),Mt=n(73);function At(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function It(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?At(n,!0).forEach(function(t){Object(Me.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):At(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Tt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Lt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tt(n,!0).forEach(function(t){Object(Me.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tt(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var _t={active:{},available:{}},Ut=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_t,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_ROOM":return console.log({oldState:Lt({},e.active[t.room.id]),newState:Lt({},e.active[t.room.id],{},t.room)}),Lt({},e,{active:Lt({},e.active,Object(Me.a)({},t.room.id,Lt({},e.active[t.room.id],{},t.room)))});case"ACTIVE_ROOM":return Lt({},e,{active:Lt({},e.active,Object(Me.a)({},t.room.id,Lt({},e.active[t.room.id],{},t.room)))});case"UPDATE_AVAILABLE_ROOMS":return Lt({},e,{available:Lt({},t.rooms.reduce(function(e,t){return Lt({},e,Object(Me.a)({},t.id,t))},{}))});case"SEND_MESSAGE":return Lt({},e,{active:Lt({},e.active,Object(Me.a)({},t.roomId,Lt({},[e.active[t.roomId]],{messages:Lt({},e.active[t.roomId].messages,Object(Me.a)({},t.message.id,t.message))})))});case"UPDATE_MESSAGES":return Lt({},e,{active:Lt({},e.active,Object(Me.a)({},t.roomId,Lt({},e.active[t.roomId],{messages:Lt({},e.active[t.roomId].messages,{},t.messages)})))});default:return e}};function Nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Bt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nt(n,!0).forEach(function(t){Object(Me.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nt(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Ft=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_ROOM_USERS_SUCCESS":return Bt({},e,{},t.payload);default:return e}},Ht=Object(Rt.c)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":return It({uid:t.uid},t.userData);case"LOGOUT":return{};default:return e}},rooms:Ut,users:Ft,redirect:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REDIRECT_TO":return{redirectTo:t.redirectTo};default:return e}}}),Gt=n(15),Jt=n.n(Gt),Vt=n(129),zt=n(13),Kt=n(165),Wt=Jt.a.mark($t),qt=Jt.a.mark(en),Xt=Jt.a.mark(tn),Qt=Jt.a.mark(nn);function Yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Zt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yt(n,!0).forEach(function(t){Object(Me.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yt(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function $t(e,t){var n,r;return Jt.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return n={},r=e.collection("messages").orderBy("createdAt","desc").limit(35),t&&(r=r.startAfter(t)),o.next=5,Object(zt.call)(N.firestore.getCollection,r);case 5:return o.sent.forEach(function(e){n[e.id]=Zt({id:e.id},e.data())}),o.abrupt("return",n);case 8:case"end":return o.stop()}},Wt)}function en(e){var t,n,r,o,a;return Jt.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return t=e.roomId,console.log("try fetch room ",t),n=B.collection("rooms").doc(t),c.next=5,Object(zt.call)(N.firestore.getDocument,n);case 5:if(!c.sent.exists){c.next=20;break}return c.next=9,Object(zt.put)(Te({id:t,isFetchingMore:!0}));case 9:return c.next=11,Object(zt.select)($e(t));case 11:return r=c.sent,c.next=14,Object(zt.call)($t,n,r.createdAt);case 14:return o=c.sent,a=35===Object.keys(o).length,c.next=18,Object(zt.put)(Ue(o,t));case 18:return c.next=20,Object(zt.put)(Te({id:t,isFetchingMore:!1,canFetchMore:a}));case 20:case"end":return c.stop()}},qt)}function tn(e){var t;return Jt.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.collection("messages").orderBy("createdAt","desc").limit(1),n.next=3,Object(zt.fork)(N.firestore.syncCollection,t,{successActionCreator:function(t){return _e(t,e.id)}});case 3:case"end":return n.stop()}},Xt)}function nn(){return Jt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(zt.takeEvery)(ve,en);case 2:case"end":return e.stop()}},Qt)}var rn=[nn()],on=Jt.a.mark(mn),an=Jt.a.mark(hn),cn=Jt.a.mark(bn),sn=Jt.a.mark(On),ln=Jt.a.mark(gn),un=Jt.a.mark(vn),pn=Jt.a.mark(yn);function fn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function dn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fn(n,!0).forEach(function(t){Object(Me.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fn(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function mn(){var e,t,n,r,o;return Jt.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(zt.select)(function(e){return e.auth});case 2:return e=a.sent,e.uid,t=Object(Kt.a)(e,["uid"]),a.next=6,Object(zt.call)(N.firestore.getCollection,"users/".concat(e.uid,"/rooms"));case 6:if((n=a.sent).empty){a.next=17;break}r=[],n.forEach(function(e){r.push(e.id)}),a.t0=Jt.a.keys(r);case 11:if((a.t1=a.t0()).done){a.next=17;break}return o=a.t1.value,a.next=15,Object(zt.call)(N.firestore.setDocument,"rooms/".concat(o,"/people/").concat(e.uid),dn({id:e.uid},t));case 15:a.next=11;break;case 17:case"end":return a.stop()}},on)}function hn(e){var t,n;return Jt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.roomId,r.next=3,Object(zt.call)(V.joinRoom,{roomId:t});case 3:return n=r.sent,console.log({response:n}),r.next=7,Object(zt.call)(On,t);case 7:case"end":return r.stop()}},an)}function bn(e){var t,n;return Jt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.roomId,console.log("calling leave function..."),r.next=4,Object(zt.call)(V.leaveRoom,{roomId:t});case 4:n=r.sent,console.log({response:n});case 6:case"end":return r.stop()}},cn)}function On(e){var t,n,r,o,a,c;return Jt.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return t=B.collection("rooms").doc(e),i.next=3,Object(zt.call)(N.firestore.getDocument,t);case 3:if(!(n=i.sent).exists){i.next=21;break}return r=n.data(),o=[],i.next=9,Object(zt.call)(N.firestore.getCollection,t.collection("people"));case 9:return i.sent.forEach(function(e){o.push(dn({id:e.id},e.data()))}),i.next=13,Object(zt.putResolve)(we(e));case 13:return i.next=15,Object(zt.call)($t,t);case 15:return a=i.sent,c=35===Object.keys(a).length,i.next=19,Object(zt.put)(Te({id:t.id,name:r.name||"-",people:o,messages:a,canFetchMore:c}));case 19:return i.next=21,Object(zt.call)(tn,t);case 21:case"end":return i.stop()}},sn)}function gn(){return Jt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(zt.takeEvery)(ye,hn);case 2:case"end":return e.stop()}},ln)}function vn(){return Jt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(zt.takeEvery)(je,bn);case 2:case"end":return e.stop()}},un)}function yn(){return Jt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(zt.takeEvery)(ge,mn);case 2:case"end":return e.stop()}},pn)}var jn=[gn(),vn(),yn()],En=Jt.a.mark(Pn),wn=Jt.a.mark(Sn);function xn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function kn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xn(n,!0).forEach(function(t){Object(Me.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xn(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Pn(e){var t,n,r,o,a,c,i,s,l,u;return Jt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(zt.select)(function(e){return e.auth});case 2:if((t=e.sent).uid){e.next=6;break}return console.log("no auth!"),e.abrupt("return");case 6:return n=B.collection("rooms").get(),e.next=9,n;case 9:return r=e.sent,o=[],r.forEach(function(e){var t=kn({id:e.id},e.data());o.push(t)}),e.next=14,Object(zt.put)(Le(o));case 14:return a=o.find(function(e){return"general"===e.name}),e.next=17,Object(zt.call)(N.firestore.getCollection,"users/".concat(t.uid,"/rooms"));case 17:if((c=e.sent).empty){e.next=34;break}i=[],c.forEach(function(e){return i.push(e.id)}),s=0,l=i;case 22:if(!(s<l.length)){e.next=29;break}return u=l[s],e.next=26,Object(zt.fork)(On,u);case 26:s++,e.next=22;break;case 29:if(!a||i.includes(a.id)){e.next=32;break}return e.next=32,Object(zt.put)({type:ye,roomId:a.id,room:a});case 32:e.next=37;break;case 34:if(!a){e.next=37;break}return e.next=37,Object(zt.put)({type:ye,roomId:a.id,room:a});case 37:case"end":return e.stop()}},En)}function Sn(){return Jt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(zt.takeLatest)(Ee,Pn);case 2:case"end":return e.stop()}},wn)}var Cn=Sn,Rn=Jt.a.mark(Dn);function Dn(){return Jt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(zt.all)([Cn()].concat(Object(Vt.a)(jn),Object(Vt.a)(rn)));case 2:case"end":return e.stop()}},Rn)}var Mn=Object(Mt.default)(),An=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||Rt.d,In=function(){var e=Object(Rt.e)(Ht,An(Object(Rt.a)(Dt.a,Mn)));return Mn.run(Dn),e}(),Tn=o.a.createElement(a.a,{store:In},o.a.createElement(c.a,null,o.a.createElement(i.a,{path:"/",component:Ct})));l.a.render(Tn,document.getElementById("container"))}},[[169,1,2]]]);
//# sourceMappingURL=main.2974fb22.chunk.js.map