(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{214:function(e,t,n){e.exports=n(384)},370:function(e,t,n){},384:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(55),c=n(154),i=n(67),s=n(6),l=n.n(s),u=(n(223),n(76)),d=n(77),m=n(79),p=n(78),f=n(80),h=n(29),g=n(30),b=n(386),O=n(47),v=n(390),j=n(387),E=n(385);function x(){var e=Object(h.a)(["\n\theight: 100%;\n\tpadding: 24;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: '#fff';\n\tjustify-content: center;\n\talign-items: center;\n"]);return x=function(){return e},e}var y=g.a.div(x()),k=function(){return r.a.createElement(y,null,r.a.createElement(E.a,{size:"large"}))},C=n(19),S=n(118),w=n.n(S),A=(n(188),n(201)),R=n.n(A),D=w.a.initializeApp({apiKey:"AIzaSyB2tCxT6yP0CWtCbD9JDj3ZKaxxW8T25PI",authDomain:"slacker-c3b01.firebaseapp.com",databaseURL:"https://slacker-c3b01.firebaseio.com",projectId:"slacker-c3b01",storageBucket:"slacker-c3b01.appspot.com",messagingSenderId:"286218247810"}),I=new R.a(D),N=w.a.firestore(),_=n(202),T=n.n(_),L=function(e,t){return new Date(e.createdAt)-new Date(t.createdAt)},M=function(e){var t=e.id,n=e.name,a=e.people,r=e.messages;return{type:"CREATE_ROOM",room:{id:t,name:n,people:a,messages:void 0===r?[]:r}}},G=function(e){return{type:"ERROR_MESSAGE",message:e}},B=function(e,t){return{type:"UPDATE_MESSAGES",messages:e,roomId:t}},V=function(e){return{type:"AVAILABLE_ROOMS",rooms:e}},U=function(e,t){var n=[];return e.forEach(function(e){n.push(Object(C.a)({id:e.id},e.data()))}),n.sort(L),B(n,t)};function J(){var e=Object(h.a)(["\n\tflex-shrink: 0;\n"]);return J=function(){return e},e}function P(){var e=Object(h.a)(["\n\tpadding-left: 14px;\n\tborder: none;\n\tborder-radius: 4px;\n\tflex-grow: 1;\n"]);return P=function(){return e},e}function K(){var e=Object(h.a)(["\n\theight: 50px;\n\tbackground-color: #fff;\n\tborder-radius: 4px;\n\tdisplay: flex;\n\tflex-direction: row;\n\tflex-shrink: 0;\n\tmargin-top: 10px;\n"]);return K=function(){return e},e}function z(){var e=Object(h.a)(["\n\tdisplay: flex;\n\tmin-height: 40px;\n\tborder-bottom: 1px solid grey;\n"]);return z=function(){return e},e}function W(){var e=Object(h.a)(["\n\tflex-grow: 1;\n\toverflow-y: scroll;\n\toverflow-x: hidden;\n"]);return W=function(){return e},e}function X(){var e=Object(h.a)(["\n\theight: 100%;\n\tpadding: 24;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: '#fff';\n"]);return X=function(){return e},e}var F=b.a.Header,H=b.a.Content,Z=j.a.Title,q=g.a.div(X()),Q=g.a.div(W()),Y=g.a.div(z()),$=g.a.form(K()),ee=g.a.input(P()),te=g.a.button(J()),ne=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={messageValue:""},n.messagesEnd=null,n.handleTyping=function(e){n.setState({messageValue:e.target.value})},n.scrollToBottom=function(){n.messagesEnd&&n.messagesEnd.scrollIntoView({behavior:"auto"})},n.handleSend=function(e){e.preventDefault();var t=n.props.room;if(t.id){var a=n.state.messageValue;n.props.trySendMessage(a,t.id),n.setState({messageValue:""})}},n}return Object(f.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(e){if(0===e.messages.length&&this.props.messages.length>0)this.scrollToBottom();else if(e.messages.length!==this.props.messages.length&&e.messages.length>0&&this.props.messages.length>0){var t=e.messages.slice(-1)[0],n=this.props.messages.slice(-1)[0];t.id!==n.id&&n&&n.sender.uid===this.props.auth.uid&&this.scrollToBottom()}}},{key:"render",value:function(){var e=this,t=this.props,n=t.room,o=t.messages,c=t.isLoading,i=r.a.createElement(k,null);return c||(i=r.a.createElement(q,null,r.a.createElement(Q,null,o.map(function(e){return r.a.createElement(Y,{key:e.id},e.text)}),r.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}})),r.a.createElement($,{onSubmit:this.handleSend},r.a.createElement(ee,{value:this.state.messageValue,onChange:this.handleTyping}),r.a.createElement(te,{type:"submit"},"Send")))),r.a.createElement(a.Fragment,null,r.a.createElement(F,{style:{background:"#fff",padding:16,display:"flex",flexRirection:"row",alignItems:"center"}},r.a.createElement(Z,{style:{margin:0},level:3},"# ",n.name)),r.a.createElement(H,{style:{margin:"24px 16px",overflow:"initial"}},i))}}]),t}(a.Component),ae=Object(o.b)(function(e,t){var n=t.match.params.roomId,a=e.rooms.joined.find(function(e){return e.id===n}),r=a?a.messages:[];return{auth:e.auth,room:a||{id:null,name:"",messages:[]},messages:r,isLoading:!a}},{trySendMessage:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(a,r){var o=r().auth;if(o){var c={sender:{uid:o.uid,displayName:o.displayName},text:e,createdAt:T()().format(),status:n};return N.collection("rooms/".concat(t,"/messages")).add(c)}}}})(ne),re=n(117),oe=n(389),ce=n(388);function ie(){var e=Object(h.a)(["\n\tmargin-top: 5px;\n\tmargin-bottom: 5px;\n"]);return ie=function(){return e},e}var se=oe.a.TextArea,le=j.a.Text,ue=g.a.div(ie()),de=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={roomName:"",description:""},n.handleChange=function(e){console.log(e.target.name),n.setState(Object(re.a)({},e.target.name,e.target.value))},n.handleSubmit=function(){var e=n.props.auth,t=e.uid,a=e.displayName;if(t){console.log("Create this room pls");var r=n.state.roomName;if(r&&r.length>0){var o={name:r,people:{id:t,name:a,unread:0,lastRead:0}};n.props.tryCreateRoom(o),n.props.handleClose()}}},n}return Object(f.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement(ce.a,{title:"Create Room",visible:this.props.isOpen,onOk:this.handleSubmit,onCancel:this.props.handleClose,okButtonProps:{disabled:!this.props.auth.uid},cancelButtonProps:{disabled:!this.props.auth.uid}},r.a.createElement(ue,null,r.a.createElement(le,null,"Name:")),r.a.createElement(oe.a,{name:"roomName",value:this.state.roomName,onChange:this.handleChange}),r.a.createElement(ue,null,r.a.createElement(le,null,"Description:")),r.a.createElement(se,{name:"description",value:this.state.description,onChange:this.handleChange,rows:4}))}}]),t}(a.Component),me=Object(o.b)(function(e){return{auth:e.auth}},{tryCreateRoom:function(e,t){return function(n,a){var r={name:e.name};return N.collection("rooms").get().then(function(a){var o=[];return a.forEach(function(e){console.log(e);var t=e.data();o.push(Object(C.a)({},t))}),o.find(function(e){return e.name===r.name})?t("Room name not available!"):N.collection("rooms").add(r).then(function(t){return N.collection("rooms/".concat(t.id,"/people")).doc(e.people.id).set(e.people).then(function(){N.collection("users/".concat(e.people.id,"/rooms")).doc(t.id).set({roomName:r.name}),n(M(Object(C.a)({id:t.id},e,{people:[e.people]}))),e.people.name})})})}}})(de);n(370);function pe(){var e=Object(h.a)(["\n\tpadding-left: 10px;\n\tcolor: rgba(255, 255, 255, 0.65);\n\tbackground: none;\n\tborder: none;\n\ttransition: color 1s;\n\tcursor: pointer;\n\t&:hover {\n\t\tcolor: #fff;\n\t}\n"]);return pe=function(){return e},e}function fe(){var e=Object(h.a)(["\n\ttext-align: center;\n\tpadding: 15px;\n"]);return fe=function(){return e},e}var he=b.a.Sider,ge=g.a.div(fe()),be=g.a.button(pe()),Oe=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={isCreateRoomDialogOpen:!1},n.handleCloseCreateChatDialog=function(){n.setState({isCreateRoomDialogOpen:!1})},n.handleOpenCreateChatDialog=function(){n.setState({isCreateRoomDialogOpen:!0})},n.handleRoomSelect=function(e){var t=e.key;n.props.history.push(t)},n}return Object(f.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.props.tryLogin()}},{key:"componentWillUpdate",value:function(e){!this.props.auth.uid&&e.auth.uid&&this.props.initSlacker()}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.location,a=t.rooms,r=t.history;"/"===n.pathname&&0===e.rooms.joined.length&&0!==a.joined.length&&(console.log("redirect to first room?"),r.push("/r/".concat(a.joined[0].id)))}},{key:"render",value:function(){return r.a.createElement(b.a,{style:{height:"100%"}},r.a.createElement(he,{style:{overflow:"auto",height:"100vh",position:"fixed",left:0}},r.a.createElement(ge,null,r.a.createElement(O.a,{icon:"plus",type:"primary",onClick:this.handleOpenCreateChatDialog},"Create room")),r.a.createElement(me,{isOpen:this.state.isCreateRoomDialogOpen,handleClose:this.handleCloseCreateChatDialog}),r.a.createElement(be,null,r.a.createElement("span",null,"Rooms:")),r.a.createElement(v.b,{theme:"dark",mode:"inline",onSelect:this.handleRoomSelect,defaultSelectedKeys:[this.props.location.pathname]},this.props.rooms.joined.map(function(e){return r.a.createElement(v.b.Item,{key:"/r/".concat(e.id)},r.a.createElement("span",{className:"nav-text"},"# ",e.name))}))),r.a.createElement(b.a,{style:{marginLeft:200}},r.a.createElement(i.c,null,r.a.createElement(i.a,{path:"/r/:roomId",component:ae}),r.a.createElement(i.a,{path:"/"},0===this.props.rooms.joined.length?r.a.createElement(k,null):r.a.createElement("div",null,"No chat selected")))))}}]),t}(a.Component),ve=Object(o.b)(function(e){return{auth:e.auth,rooms:e.rooms}},{tryLogin:function(){return function(e){return w.a.auth().signInAnonymously().then(function(t){var n=t.user;if(n){var a=n.displayName||"Ninja";return e(function(e,t){return{type:"LOGIN",uid:e,displayName:t}}(n.uid,a))}}).catch(function(e){console.log({error:e}),e.code,e.message})}},initSlacker:function(){return{type:"INIT_SLACKER_SAGA"}}})(Oe),je=n(40),Ee=n(211),xe=n(75),ye=n(95),ke={joined:[],available:[]},Ce=Object(je.c)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":return{uid:t.uid,displayName:t.displayName};case"LOGOUT":return{};default:return e}},rooms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ke,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CREATE_ROOM":case"JOINED_ROOM":return Object(C.a)({},e,{joined:[].concat(Object(ye.a)(e.joined),[t.room])});case"AVAILABLE_ROOMS":return Object(C.a)({},e,{available:t.rooms});case"SEND_MESSAGE":return Object(C.a)({},e,{joined:e.joined.map(function(e){return e.name===t.roomName?Object(C.a)({},e,{messages:[].concat(Object(ye.a)(e.messages),[t.message])}):e})});case"UPDATE_MESSAGES":return Object(C.a)({},e,{joined:e.joined.map(function(e){return e.id===t.roomId?Object(C.a)({},e,{messages:Object(ye.a)(t.messages)}):e})});default:return e}},redirect:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REDIRECT_TO":return{redirectTo:t.redirectTo};default:return e}}}),Se=n(25),we=n.n(Se),Ae=n(15),Re=we.a.mark(_e),De=we.a.mark(Te),Ie=we.a.mark(Le),Ne=function(e,t){return new Date(e.createdAt)-new Date(t.createdAt)};function _e(e){var t,n,a,r,o;return we.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return console.log("try fetch room ",e),t=N.collection("rooms").doc(e),c.next=4,Object(Ae.call)(I.firestore.getDocument,t);case 4:if(!(n=c.sent).exists){c.next=24;break}return a=n.data(),r=[],o=[],c.next=11,Object(Ae.call)(I.firestore.getCollection,t.collection("people"));case 11:return c.sent.forEach(function(e){r.push(Object(C.a)({id:e.id},e.data()))}),console.log({people:r}),c.next=16,Object(Ae.call)(I.firestore.getCollection,t.collection("messages"));case 16:return c.sent.forEach(function(e){o.push(Object(C.a)({id:e.id},e.data()))}),o.sort(Ne),console.log({messages:o}),c.next=22,Object(Ae.put)(M({id:t.id,name:a?a.name:"Error",people:r,messages:o}));case 22:return c.next=24,Object(Ae.fork)(I.firestore.syncCollection,t.collection("messages"),{successActionCreator:function(t){return U(t,e)}});case 24:case"end":return c.stop()}},Re)}function Te(e){var t,n,a,r,o,c,i,s,l,u;return we.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ae.select)(function(e){return e.auth});case 2:if((t=e.sent).uid){e.next=6;break}return console.log("no auth!"),e.abrupt("return");case 6:return n=N.collection("rooms").get(),e.next=9,n;case 9:return a=e.sent,r=[],a.forEach(function(e){var t=Object(C.a)({id:e.id},e.data());r.push(t)}),e.next=14,Object(Ae.put)(V(r));case 14:return o=r.find(function(e){return"general"===e.name}),e.next=17,Object(Ae.call)(I.firestore.getCollection,"users/".concat(t.uid,"/rooms"));case 17:if((c=e.sent).empty){e.next=35;break}i=[],c.forEach(function(e){return i.push(e.id)}),s=0,l=i;case 22:if(!(s<l.length)){e.next=30;break}return u=l[s],e.next=26,Object(Ae.fork)(_e,u);case 26:e.sent;case 27:s++,e.next=22;break;case 30:if(!o||i.includes(o.id)){e.next=33;break}return e.next=33,Object(Ae.put)({type:"JOIN_ROOM_SAGA",roomId:o.id,room:o});case 33:e.next=38;break;case 35:if(!o){e.next=38;break}return e.next=38,Object(Ae.put)({type:"JOIN_ROOM_SAGA",roomId:o.id,room:o});case 38:case"end":return e.stop()}},De)}function Le(){return we.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ae.takeLatest)("INIT_SLACKER_SAGA",Te);case 2:case"end":return e.stop()}},Ie)}var Me=Le,Ge=we.a.mark(Ve),Be=we.a.mark(Ue);function Ve(e){var t,n,a,r,o,c,i,s;return we.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return t=e.roomId,l.next=3,Object(Ae.select)(function(e){return e.auth});case 3:return n=l.sent,a=n.uid,r=n.displayName,o=N.doc("rooms/".concat(t)),l.next=9,Object(Ae.call)(I.firestore.getDocument,o);case 9:if(c=l.sent,(i=Object(C.a)({id:c.id},c.data()))&&c.exists){l.next=17;break}return l.next=14,Object(Ae.put)(G("Room not found!"));case 14:return l.abrupt("return");case 17:if(!i.people||!i.people.find(function(e){return e.id===a})){l.next=21;break}return l.abrupt("return");case 21:return s={name:r,id:a,unread:0,lastRead:0},l.next=24,Object(Ae.call)(I.firestore.setDocument,"rooms/".concat(t,"/people/").concat(s.id),s);case 24:return l.next=26,Object(Ae.call)(I.firestore.setDocument,"users/".concat(s.id,"/rooms/").concat(t),{roomName:i.name});case 26:return l.next=28,Object(Ae.call)(_e,t);case 28:case"end":return l.stop()}},Ge)}function Ue(){return we.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ae.takeEvery)("JOIN_ROOM_SAGA",Ve);case 2:case"end":return e.stop()}},Be)}var Je=Ue,Pe=we.a.mark(Ke);function Ke(){return we.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ae.all)([Me(),Je()]);case 2:case"end":return e.stop()}},Pe)}var ze=Object(xe.default)(),We=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||je.d,Xe=function(){var e=Object(je.e)(Ce,We(Object(je.a)(Ee.a,ze)));return ze.run(Ke),e}(),Fe=r.a.createElement(o.a,{store:Xe},r.a.createElement(c.a,null,r.a.createElement(i.a,{path:"/",component:ve})));l.a.render(Fe,document.getElementById("container"))}},[[214,1,2]]]);
//# sourceMappingURL=main.68c07459.chunk.js.map